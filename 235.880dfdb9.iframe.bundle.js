/*! For license information please see 235.880dfdb9.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunk_fjdr_react_diagrams_gallery=self.webpackChunk_fjdr_react_diagrams_gallery||[]).push([[235],{"./demos/helpers/DemoCanvasWidget.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{_:()=>DemoCanvasWidget});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),_emotion_styled__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../node_modules/.pnpm/@emotion+styled@11.11.0_@emotion+react@11.11.1_@types+react@18.2.22_react@18.2.0__@types+react@18.2.22_react@18.2.0/node_modules/@emotion/styled/dist/emotion-styled.browser.esm.js"),_emotion_react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../node_modules/.pnpm/@emotion+react@11.11.1_@types+react@18.2.22_react@18.2.0/node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let S;var _S;(_S=S||(S={})).Container=_emotion_styled__WEBPACK_IMPORTED_MODULE_1__.Z.div`
		height: 100%;
		background-color: ${p=>p.background};
		background-size: 50px 50px;
		display: flex;

		> * {
			height: 100%;
			min-height: 100%;
			width: 100%;
		}

		background-image: linear-gradient(
				0deg,
				transparent 24%,
				${p=>p.color} 25%,
				${p=>p.color} 26%,
				transparent 27%,
				transparent 74%,
				${p=>p.color} 75%,
				${p=>p.color} 76%,
				transparent 77%,
				transparent
			),
			linear-gradient(
				90deg,
				transparent 24%,
				${p=>p.color} 25%,
				${p=>p.color} 26%,
				transparent 27%,
				transparent 74%,
				${p=>p.color} 75%,
				${p=>p.color} 76%,
				transparent 77%,
				transparent
			);
	`,_S.Expand=_emotion_react__WEBPACK_IMPORTED_MODULE_3__.iv`
		html,
		body,
		#root {
			height: 100%;
		}
	`;class DemoCanvasWidget extends react__WEBPACK_IMPORTED_MODULE_0__.Component{render(){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_emotion_react__WEBPACK_IMPORTED_MODULE_3__.xB,{styles:S.Expand}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(S.Container,{background:this.props.background||"rgb(60, 60, 60)",color:this.props.color||"rgba(255,255,255, 0.05)",children:this.props.children})]})}}DemoCanvasWidget.displayName="DemoCanvasWidget"},"../packages/geometry/dist/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{hr:()=>BezierCurve,E9:()=>Point,Ae:()=>Rectangle,dq:()=>boundingBoxFromPoints,zh:()=>boundingBoxFromPolygons});class Matrix{constructor(matrix){this.matrix=matrix}mmul(matrix){return this.matrix=this.matrix.map(((row,i)=>matrix.asArray()[0].map(((_,j)=>row.reduce(((acc,_,n)=>acc+this.matrix[i][n]*matrix.asArray()[n][j]),0))))),this}asArray(){return this.matrix}get(rowIndex,columnIndex){return this.asArray()[rowIndex][columnIndex]}static multiply(...matrices){let m=matrices[0];for(let i=1;i<matrices.length;i++)m=m.mmul(matrices[i]);return m}static scaleMatrix(x,y){return new Matrix([[x,0,0],[0,y,0],[0,0,1]])}static translateMatrix(x,y){return new Matrix([[1,0,x],[0,1,y],[0,0,1]])}static rotateMatrix(deg){return new Matrix([[Math.cos(deg),-1*Math.sin(deg),0],[Math.sin(deg),Math.cos(deg),0],[0,0,1]])}static createScaleMatrix(x,y,origin){return this.multiply(Matrix.translateMatrix(origin.x,origin.y),Matrix.scaleMatrix(x,y),Matrix.translateMatrix(-origin.x,-origin.y))}static createRotateMatrix(deg,origin){return this.multiply(Matrix.translateMatrix(origin.x,origin.y),Matrix.rotateMatrix(deg),Matrix.translateMatrix(-origin.x,-origin.y))}}class Point{constructor(x=0,y=0){this.x=x,this.y=y}translate(x,y){this.x+=x,this.y+=y}clone(){return new Point(this.x,this.y)}toSVG(){return this.x+" "+this.y}asMatrix(){return new Matrix([[this.x],[this.y],[1]])}transform(matrix){let final=matrix.mmul(this.asMatrix());this.x=final.get(0,0),this.y=final.get(1,0)}static middlePoint(pointA,pointB){return new Point((pointB.x+pointA.x)/2,(pointB.y+pointA.y)/2)}}var BoundsCorner,forEach=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/forEach.js"),forEach_default=__webpack_require__.n(forEach),map=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/map.js"),map_default=__webpack_require__.n(map),flatMap=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/flatMap.js"),flatMap_default=__webpack_require__.n(flatMap);!function(BoundsCorner){BoundsCorner.TOP_LEFT="TL",BoundsCorner.TOP_RIGHT="TR",BoundsCorner.BOTTOM_RIGHT="BR",BoundsCorner.BOTTOM_LEFT="BL"}(BoundsCorner||(BoundsCorner={}));const boundsFromPositionAndSize=(x,y,width,height)=>({[BoundsCorner.TOP_LEFT]:new Point(x,y),[BoundsCorner.TOP_RIGHT]:new Point(x+width,y),[BoundsCorner.BOTTOM_RIGHT]:new Point(x+width,y+height),[BoundsCorner.BOTTOM_LEFT]:new Point(x,y+height)}),createEmptyBounds=()=>({[BoundsCorner.TOP_LEFT]:new Point,[BoundsCorner.TOP_RIGHT]:new Point,[BoundsCorner.BOTTOM_RIGHT]:new Point,[BoundsCorner.BOTTOM_LEFT]:new Point}),boundingBoxFromPoints=points=>{if(0===points.length)return createEmptyBounds();let minX=points[0].x,maxX=points[0].x,minY=points[0].y,maxY=points[0].y;for(let i=1;i<points.length;i++)points[i].x<minX&&(minX=points[i].x),points[i].x>maxX&&(maxX=points[i].x),points[i].y<minY&&(minY=points[i].y),points[i].y>maxY&&(maxY=points[i].y);return{[BoundsCorner.TOP_LEFT]:new Point(minX,minY),[BoundsCorner.TOP_RIGHT]:new Point(maxX,minY),[BoundsCorner.BOTTOM_RIGHT]:new Point(maxX,maxY),[BoundsCorner.BOTTOM_LEFT]:new Point(minX,maxY)}},boundingBoxFromPolygons=polygons=>boundingBoxFromPoints(flatMap_default()(polygons,(polygon=>polygon.getPoints())));class Polygon{constructor(points=[]){this.points=points}serialize(){return map_default()(this.points,(point=>[point.x,point.y]))}deserialize(data){this.points=map_default()(data,(point=>new Point(point[0],point[1])))}scale(x,y,origin){let matrix=Matrix.createScaleMatrix(x,y,origin);forEach_default()(this.points,(point=>{point.transform(matrix)}))}transform(matrix){forEach_default()(this.points,(point=>{point.transform(matrix)}))}setPoints(points){this.points=points}getPoints(){return this.points}rotate(degrees){this.transform(Matrix.createRotateMatrix(degrees/(180/Math.PI),this.getOrigin()))}translate(offsetX,offsetY){forEach_default()(this.points,(point=>{point.translate(offsetX,offsetY)}))}doClone(ob){this.points=map_default()(ob.points,(point=>point.clone()))}clone(){let ob=Object.create(this);return ob.doClone(this),ob}getOrigin(){if(0===this.points.length)return null;let dimensions=boundingBoxFromPoints(this.points);return Point.middlePoint(dimensions[BoundsCorner.TOP_LEFT],dimensions[BoundsCorner.BOTTOM_RIGHT])}getBoundingBox(){return boundingBoxFromPoints(this.points)}}class Rectangle extends Polygon{static fromPositionAndSize(x,y,width,height){return new Rectangle(boundsFromPositionAndSize(x,y,width,height))}static fromPointAndSize(position,width,height){return new Rectangle(boundsFromPositionAndSize(position.x,position.y,width,height))}constructor(points){points||(points=createEmptyBounds()),super([points[BoundsCorner.TOP_LEFT],points[BoundsCorner.TOP_RIGHT],points[BoundsCorner.BOTTOM_RIGHT],points[BoundsCorner.BOTTOM_LEFT]])}updateDimensions(x,y,width,height){const points=boundsFromPositionAndSize(x,y,width,height);this.setPoints([points[BoundsCorner.TOP_LEFT],points[BoundsCorner.TOP_RIGHT],points[BoundsCorner.BOTTOM_RIGHT],points[BoundsCorner.BOTTOM_LEFT]])}setPoints(points){if(4!==points.length)throw"Rectangles must always have 4 points";super.setPoints(points)}containsPoint(point){const tl=this.getTopLeft(),br=this.getBottomRight();return point.x>=tl.x&&point.x<=br.x&&point.y>=tl.y&&point.y<=br.y}getWidth(){return Math.sqrt(Math.pow(this.getTopLeft().x-this.getTopRight().x,2)+Math.pow(this.getTopLeft().y-this.getTopRight().y,2))}getHeight(){return Math.sqrt(Math.pow(this.getBottomLeft().x-this.getTopLeft().x,2)+Math.pow(this.getBottomLeft().y-this.getTopLeft().y,2))}getTopMiddle(){return Point.middlePoint(this.getTopLeft(),this.getTopRight())}getBottomMiddle(){return Point.middlePoint(this.getBottomLeft(),this.getBottomRight())}getLeftMiddle(){return Point.middlePoint(this.getBottomLeft(),this.getTopLeft())}getRightMiddle(){return Point.middlePoint(this.getBottomRight(),this.getTopRight())}getTopLeft(){return this.points[0]}getTopRight(){return this.points[1]}getBottomRight(){return this.points[2]}getBottomLeft(){return this.points[3]}getLeft(){return Math.min(this.getTopLeft().x,this.getBottomLeft().x)}getRight(){return Math.max(this.getTopRight().x,this.getBottomRight().x)}getTop(){return Math.min(this.getTopLeft().y,this.getTopRight().y)}getBottom(){return Math.max(this.getBottomLeft().y,this.getBottomRight().y)}}var BezierCurvepPoints;!function(BezierCurvepPoints){BezierCurvepPoints[BezierCurvepPoints.SOURCE=0]="SOURCE",BezierCurvepPoints[BezierCurvepPoints.SOURCE_CONTROL=1]="SOURCE_CONTROL",BezierCurvepPoints[BezierCurvepPoints.TARGET_CONTROL=2]="TARGET_CONTROL",BezierCurvepPoints[BezierCurvepPoints.TARGET=3]="TARGET"}(BezierCurvepPoints||(BezierCurvepPoints={}));class BezierCurve extends Polygon{constructor(){super([new Point(0,0),new Point(0,0),new Point(0,0),new Point(0,0)])}getSVGCurve(){return`M${this.getSource().toSVG()} C${this.getSourceControl().toSVG()}, ${this.getTargetControl().toSVG()}, ${this.getTarget().toSVG()}`}setPoints(points){if(4!==points.length)throw new Error("BezierCurve must have extactly 4 points");super.setPoints(points)}getSource(){return this.points[BezierCurvepPoints.SOURCE]}getSourceControl(){return this.points[BezierCurvepPoints.SOURCE_CONTROL]}getTargetControl(){return this.points[BezierCurvepPoints.TARGET_CONTROL]}getTarget(){return this.points[BezierCurvepPoints.TARGET]}setSource(point){this.points[BezierCurvepPoints.SOURCE]=point}setSourceControl(point){this.points[BezierCurvepPoints.SOURCE_CONTROL]=point}setTargetControl(point){this.points[BezierCurvepPoints.TARGET_CONTROL]=point}setTarget(point){this.points[BezierCurvepPoints.TARGET]=point}}},"../packages/react-canvas-core/dist/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{s2:()=>AbstractDisplacementState,Zi:()=>AbstractModelFactory,a3:()=>AbstractReactFactory,aU:()=>Action_Action,gq:()=>BaseModel,NW:()=>BasePositionModel,u1:()=>CanvasEngine,N5:()=>CanvasModel,JE:()=>CanvasWidget,zp:()=>DeleteItemsAction,qR:()=>DragCanvasState_DragCanvasState,r3:()=>FactoryBank,n$:()=>Action_InputType,iz:()=>LayerModel,C2:()=>MoveItemsState_MoveItemsState,G:()=>PeformanceWidget,If:()=>SelectingState_SelectingState,B1:()=>SelectionBoxLayerFactory,ZM:()=>State_State,C7:()=>Toolkit});var debounce=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/debounce.js"),debounce_default=__webpack_require__.n(debounce);class Toolkit{static UID(){return Toolkit.TESTING?(Toolkit.TESTING_UID++,`${Toolkit.TESTING_UID}`):"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(c=>{const r=16*Math.random()|0;return("x"===c?r:3&r|8).toString(16)}))}static closest(element,selector){return Element.prototype.closest||(Element.prototype.closest=function(s){var el=this;do{if(Element.prototype.matches.call(el,s))return el;el=el.parentElement||el.parentNode}while(null!==el&&1===el.nodeType);return null}),element.closest(selector)}}Toolkit.TESTING=!1,Toolkit.TESTING_UID=0;class BaseObserver{constructor(){this.listeners={}}fireEventInternal(fire,k,event){this.iterateListeners((listener=>{if(!fire&&!event.firing)return!1;listener[k]&&listener[k](event)}))}fireEvent(event,k){event=Object.assign({firing:!0,stopPropagation:()=>{event.firing=!1}},event),this.fireEventInternal(!0,"eventWillFire",Object.assign(Object.assign({},event),{function:k})),this.fireEventInternal(!1,k,event),this.fireEventInternal(!0,"eventDidFire",Object.assign(Object.assign({},event),{function:k}))}iterateListeners(cb){for(let id in this.listeners){if(!1===cb(this.listeners[id]))return}}getListenerHandle(listener){for(let id in this.listeners)if(this.listeners[id]===listener)return{id,listener,deregister:()=>{delete this.listeners[id]}}}registerListener(listener){const id=Toolkit.UID();return this.listeners[id]=listener,{id,listener,deregister:()=>{delete this.listeners[id]}}}deregisterListener(listener){if("object"==typeof listener)return listener.deregister(),!0;const handle=this.getListenerHandle(listener);return!!handle&&(handle.deregister(),!0)}}var values=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/values.js"),values_default=__webpack_require__.n(values);class FactoryBank extends BaseObserver{constructor(){super(),this.factories={}}getFactories(){return values_default()(this.factories)}clearFactories(){for(let factory in this.factories)this.deregisterFactory(factory)}getFactory(type){if(!this.factories[type])throw new Error(`Cannot find factory with type [${type}]`);return this.factories[type]}registerFactory(factory){factory.setFactoryBank(this),this.factories[factory.getType()]=factory,this.fireEvent({factory},"factoryAdded")}deregisterFactory(type){const factory=this.factories[type];factory.setFactoryBank(null),delete this.factories[type],this.fireEvent({factory},"factoryRemoved")}}var Action_InputType,dist=__webpack_require__("../packages/geometry/dist/index.js");!function(InputType){InputType.MOUSE_DOWN="mouse-down",InputType.MOUSE_UP="mouse-up",InputType.MOUSE_MOVE="mouse-move",InputType.MOUSE_WHEEL="mouse-wheel",InputType.KEY_DOWN="key-down",InputType.KEY_UP="key-up",InputType.TOUCH_START="touch-start",InputType.TOUCH_END="touch-end",InputType.TOUCH_MOVE="touch-move"}(Action_InputType||(Action_InputType={}));class Action_Action{constructor(options){this.options=options,this.id=Toolkit.UID()}setEngine(engine){this.engine=engine}}var filter=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/filter.js"),filter_default=__webpack_require__.n(filter),keys=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/keys.js"),keys_default=__webpack_require__.n(keys);class ActionEventBus{constructor(engine){this.actions={},this.engine=engine,this.keys={}}getKeys(){return keys_default()(this.keys)}registerAction(action){return action.setEngine(this.engine),this.actions[action.id]=action,()=>{this.deregisterAction(action)}}deregisterAction(action){action.setEngine(null),delete this.actions[action.id]}getActionsForType(type){return filter_default()(this.actions,(action=>action.options.type===type))}getModelForEvent(actionEvent){return actionEvent.model?actionEvent.model:this.engine.getMouseElement(actionEvent.event)}getActionsForEvent(actionEvent){const{event}=actionEvent;return"mousedown"===event.type?this.getActionsForType(Action_InputType.MOUSE_DOWN):"mouseup"===event.type?this.getActionsForType(Action_InputType.MOUSE_UP):"keydown"===event.type?(this.keys[event.key.toLowerCase()]=!0,this.getActionsForType(Action_InputType.KEY_DOWN)):"keyup"===event.type?(delete this.keys[event.key.toLowerCase()],this.getActionsForType(Action_InputType.KEY_UP)):"mousemove"===event.type?this.getActionsForType(Action_InputType.MOUSE_MOVE):"wheel"===event.type?this.getActionsForType(Action_InputType.MOUSE_WHEEL):"touchstart"===event.type?this.getActionsForType(Action_InputType.TOUCH_START):"touchend"===event.type?this.getActionsForType(Action_InputType.TOUCH_END):"touchmove"===event.type?this.getActionsForType(Action_InputType.TOUCH_MOVE):[]}fireAction(actionEvent){const actions=this.getActionsForEvent(actionEvent);for(let action of actions)action.options.fire(actionEvent)}}class PanAndZoomCanvasAction extends Action_Action{constructor(options={}){super({type:Action_InputType.MOUSE_WHEEL,fire:actionEvent=>{const{event}=actionEvent;for(let layer of this.engine.getModel().getLayers())layer.allowRepaint(!1);const model=this.engine.getModel();if(event.stopPropagation(),event.ctrlKey){const oldZoomFactor=this.engine.getModel().getZoomLevel()/100;let scrollDelta=options.inverseZoom?event.deltaY:-event.deltaY;scrollDelta/=3,model.getZoomLevel()+scrollDelta>10&&model.setZoomLevel(model.getZoomLevel()+scrollDelta);const zoomFactor=model.getZoomLevel()/100,boundingRect=event.currentTarget.getBoundingClientRect(),clientWidth=boundingRect.width,clientHeight=boundingRect.height,widthDiff=clientWidth*zoomFactor-clientWidth*oldZoomFactor,heightDiff=clientHeight*zoomFactor-clientHeight*oldZoomFactor,clientX=event.clientX-boundingRect.left,clientY=event.clientY-boundingRect.top,xFactor=(clientX-model.getOffsetX())/oldZoomFactor/clientWidth,yFactor=(clientY-model.getOffsetY())/oldZoomFactor/clientHeight;model.setOffset(model.getOffsetX()-widthDiff*xFactor,model.getOffsetY()-heightDiff*yFactor)}else{let yDelta=options.inverseZoom?-event.deltaY:event.deltaY,xDelta=options.inverseZoom?-event.deltaX:event.deltaX;model.setOffset(model.getOffsetX()-xDelta,model.getOffsetY()-yDelta)}this.engine.repaintCanvas();for(let layer of this.engine.getModel().getLayers())layer.allowRepaint(!0)}})}}class ZoomCanvasAction extends Action_Action{constructor(options={}){super({type:Action_InputType.MOUSE_WHEEL,fire:actionEvent=>{const{event}=actionEvent;for(let layer of this.engine.getModel().getLayers())layer.allowRepaint(!1);const model=this.engine.getModel();event.stopPropagation();const oldZoomFactor=this.engine.getModel().getZoomLevel()/100;let scrollDelta=options.inverseZoom?-event.deltaY:event.deltaY;event.ctrlKey&&scrollDelta%1!=0?scrollDelta/=3:scrollDelta/=60,model.getZoomLevel()+scrollDelta>10&&model.setZoomLevel(model.getZoomLevel()+scrollDelta);const zoomFactor=model.getZoomLevel()/100,boundingRect=event.currentTarget.getBoundingClientRect(),clientWidth=boundingRect.width,clientHeight=boundingRect.height,widthDiff=clientWidth*zoomFactor-clientWidth*oldZoomFactor,heightDiff=clientHeight*zoomFactor-clientHeight*oldZoomFactor,clientX=event.clientX-boundingRect.left,clientY=event.clientY-boundingRect.top,xFactor=(clientX-model.getOffsetX())/oldZoomFactor/clientWidth,yFactor=(clientY-model.getOffsetY())/oldZoomFactor/clientHeight;model.setOffset(model.getOffsetX()-widthDiff*xFactor,model.getOffsetY()-heightDiff*yFactor),this.engine.repaintCanvas();for(let layer of this.engine.getModel().getLayers())layer.allowRepaint(!0)}})}}var forEach=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/forEach.js"),forEach_default=__webpack_require__.n(forEach),isEqual=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/isEqual.js"),isEqual_default=__webpack_require__.n(isEqual);class DeleteItemsAction extends Action_Action{constructor(options={}){const keyCodes=options.keyCodes||[46,8],modifiers=Object.assign({ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1},options.modifiers);super({type:Action_InputType.KEY_DOWN,fire:event=>{const{keyCode,ctrlKey,shiftKey,altKey,metaKey}=event.event,isEdited=this.engine.getModel().getEdited();-1!==keyCodes.indexOf(keyCode)&&isEqual_default()({ctrlKey,shiftKey,altKey,metaKey},modifiers)&&!isEdited&&(forEach_default()(this.engine.getModel().getSelectedEntities(),(model=>{model.isLocked()||model.remove()})),this.engine.repaintCanvas())}})}}var last=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/last.js"),last_default=__webpack_require__.n(last);class StateMachine extends BaseObserver{constructor(engine){super(),this.engine=engine,this.stateStack=[]}getCurrentState(){return this.currentState}pushState(state){this.stateStack.push(state),this.setState(state)}popState(){this.stateStack.pop(),this.setState(last_default()(this.stateStack))}setState(state){state.setEngine(this.engine),this.currentState&&this.currentState.deactivated(state);const old=this.currentState;this.currentState=state,this.currentState&&(this.currentState.activated(old),this.fireEvent({newState:state},"stateChanged"))}}class CanvasEngine extends BaseObserver{constructor(options={}){super(),this.model=null,this.eventBus=new ActionEventBus(this),this.stateMachine=new StateMachine(this),this.layerFactories=new FactoryBank,this.registerFactoryBank(this.layerFactories),this.options=Object.assign({registerDefaultDeleteItemsAction:!0,registerDefaultZoomCanvasAction:!0,repaintDebounceMs:0},options),!0===this.options.registerDefaultZoomCanvasAction?this.eventBus.registerAction(new ZoomCanvasAction):!0===this.options.registerDefaultPanAndZoomCanvasAction&&this.eventBus.registerAction(new PanAndZoomCanvasAction),!0===this.options.registerDefaultDeleteItemsAction&&this.eventBus.registerAction(new DeleteItemsAction)}getStateMachine(){return this.stateMachine}getRelativeMousePoint(event){const point=this.getRelativePoint(event.clientX,event.clientY);return new dist.E9((point.x-this.model.getOffsetX())/(this.model.getZoomLevel()/100),(point.y-this.model.getOffsetY())/(this.model.getZoomLevel()/100))}getRelativePoint(x,y){const canvasRect=this.canvas.getBoundingClientRect();return new dist.E9(x-canvasRect.left,y-canvasRect.top)}registerFactoryBank(factory){factory.registerListener({factoryAdded:event=>{event.factory.setDiagramEngine(this)},factoryRemoved:event=>{event.factory.setDiagramEngine(null)}})}getActionEventBus(){return this.eventBus}getLayerFactories(){return this.layerFactories}getFactoryForLayer(layer){return"string"==typeof layer?this.layerFactories.getFactory(layer):this.layerFactories.getFactory(layer.getType())}setModel(model){this.model=model,this.canvas&&requestAnimationFrame((()=>{this.repaintCanvas()}))}getModel(){return this.model}repaintCanvas(promise){const{repaintDebounceMs}=this.options,repaint=()=>{this.iterateListeners((listener=>{listener.repaintCanvas&&listener.repaintCanvas()}))};let repaintFn=repaint;if(repaintDebounceMs>0&&(repaintFn=debounce_default()(repaint,repaintDebounceMs)),promise)return new Promise((resolve=>{const l=this.registerListener({rendered:()=>{resolve(),l.deregister()}});repaintFn()}));repaintFn()}setCanvas(canvas){this.canvas!==canvas&&(this.canvas=canvas,canvas&&this.fireEvent({},"canvasReady"))}getCanvas(){return this.canvas}getMouseElement(event){return null}zoomToFit(){const xFactor=this.canvas.clientWidth/this.canvas.scrollWidth,yFactor=this.canvas.clientHeight/this.canvas.scrollHeight,zoomFactor=xFactor<yFactor?xFactor:yFactor;this.model.setZoomLevel(this.model.getZoomLevel()*zoomFactor),this.model.setOffset(0,0),this.repaintCanvas()}}var flatMap=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/flatMap.js"),flatMap_default=__webpack_require__.n(flatMap),map=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/map.js"),map_default=__webpack_require__.n(map),cloneDeep=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/cloneDeep.js"),cloneDeep_default=__webpack_require__.n(cloneDeep);class BaseEntity extends BaseObserver{constructor(options={}){super(),this.options=Object.assign({id:Toolkit.UID()},options)}getOptions(){return this.options}getID(){return this.options.id}doClone(lookupTable={},clone){}clone(lookupTable={}){if(lookupTable[this.options.id])return lookupTable[this.options.id];let clone=cloneDeep_default()(this);return clone.options=Object.assign(Object.assign({},this.options),{id:Toolkit.UID()}),clone.clearListeners(),lookupTable[this.options.id]=clone,this.doClone(lookupTable,clone),clone}clearListeners(){this.listeners={}}deserialize(event){this.options.id=event.data.id,this.options.locked=event.data.locked}serialize(){return{id:this.options.id,locked:this.options.locked}}fireEvent(event,k){super.fireEvent(Object.assign({entity:this},event),k)}isLocked(){return this.options.locked}setLocked(locked=!0){this.options.locked=locked,this.fireEvent({locked},"lockChanged")}}class CanvasModel extends BaseEntity{constructor(options={}){super(Object.assign({zoom:100,gridSize:0,offsetX:0,offsetY:0},options)),this.layers=[],this.edited=!1}getSelectionEntities(){return flatMap_default()(this.layers,(layer=>layer.getSelectionEntities()))}getSelectedEntities(){return filter_default()(this.getSelectionEntities(),(ob=>ob.isSelected()))}clearSelection(){forEach_default()(this.getSelectedEntities(),(element=>{element.setSelected(!1)}))}getModels(){return flatMap_default()(this.layers,(layer=>values_default()(layer.getModels())))}setEdited(value){this.edited=value}getEdited(){return this.edited}addLayer(layer){layer.setParent(this),layer.registerListener({entityRemoved:event=>{}}),this.layers.push(layer)}removeLayer(layer){const index=this.layers.indexOf(layer);return-1!==index&&(this.layers.splice(index,1),!0)}getLayers(){return this.layers}setGridSize(size=0){this.options.gridSize=size,this.fireEvent({size},"gridUpdated")}getGridPosition(pos){return 0===this.options.gridSize?pos:this.options.gridSize*Math.floor((pos+this.options.gridSize/2)/this.options.gridSize)}deserializeModel(data,engine){const models={},promises={},resolvers={},event={data,engine,registerModel:model=>{models[model.getID()]=model,resolvers[model.getID()]&&resolvers[model.getID()](model)},getModel:id=>models[id]?Promise.resolve(models[id]):(promises[id]||(promises[id]=new Promise((resolve=>{resolvers[id]=resolve}))),promises[id])};this.deserialize(event)}deserialize(event){super.deserialize(event),this.options.offsetX=event.data.offsetX,this.options.offsetY=event.data.offsetY,this.options.zoom=event.data.zoom,this.options.gridSize=event.data.gridSize,forEach_default()(event.data.layers,(layer=>{const layerOb=event.engine.getFactoryForLayer(layer.type).generateModel({initialConfig:layer});layerOb.deserialize(Object.assign(Object.assign({},event),{data:layer})),this.addLayer(layerOb)}))}serialize(){return Object.assign(Object.assign({},super.serialize()),{offsetX:this.options.offsetX,offsetY:this.options.offsetY,zoom:this.options.zoom,gridSize:this.options.gridSize,layers:map_default()(this.layers,(layer=>layer.serialize()))})}setZoomLevel(zoom){this.options.zoom=zoom,this.fireEvent({zoom},"zoomUpdated")}setOffset(offsetX,offsetY){this.options.offsetX=offsetX,this.options.offsetY=offsetY,this.fireEvent({offsetX,offsetY},"offsetUpdated")}setOffsetX(offsetX){this.setOffset(offsetX,this.options.offsetY)}setOffsetY(offsetY){this.setOffset(this.options.offsetX,offsetY)}getOffsetY(){return this.options.offsetY}getOffsetX(){return this.options.offsetX}getZoomLevel(){return this.options.zoom}}class AbstractFactory{constructor(type){this.type=type}setDiagramEngine(engine){this.engine=engine}setFactoryBank(bank){this.bank=bank}getType(){return this.type}}class AbstractModelFactory extends AbstractFactory{}class AbstractReactFactory extends AbstractModelFactory{}class BaseModel extends BaseEntity{constructor(options){super(options)}performanceTune(){return!0}getParentCanvasModel(){return this.parent?this.parent instanceof CanvasModel?this.parent:this.parent instanceof BaseModel?this.parent.getParentCanvasModel():null:null}getParent(){return this.parent}setParent(parent){this.parent=parent}getSelectionEntities(){return[this]}serialize(){return Object.assign(Object.assign({},super.serialize()),{type:this.options.type,selected:this.options.selected,extras:this.options.extras})}deserialize(event){super.deserialize(event),this.options.extras=event.data.extras,this.options.selected=event.data.selected}getType(){return this.options.type}isSelected(){return this.options.selected}isLocked(){return!!super.isLocked()||!!this.parent&&this.parent.isLocked()}setSelected(selected=!0){this.options.selected!==selected&&(this.options.selected=selected,this.fireEvent({isSelected:selected},"selectionChanged"))}remove(){this.fireEvent({},"entityRemoved")}}class BasePositionModel extends BaseModel{constructor(options){super(options),this.position=options.position||new dist.E9(0,0)}setPosition(x,y){x instanceof dist.E9?this.position=x:this.position=new dist.E9(x,y),this.fireEvent({},"positionChanged")}getBoundingBox(){return dist.Ae.fromPointAndSize(this.position,0,0)}deserialize(event){super.deserialize(event),this.position=new dist.E9(event.data.x,event.data.y)}serialize(){return Object.assign(Object.assign({},super.serialize()),{x:this.position.x,y:this.position.y})}getPosition(){return this.position}getX(){return this.position.x}getY(){return this.position.y}}var S,CanvasWidget_S,react=__webpack_require__("../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),emotion_styled_browser_esm=__webpack_require__("../node_modules/.pnpm/@emotion+styled@11.11.0_@emotion+react@11.11.1_@types+react@18.2.22_react@18.2.0__@types+react@18.2.22_react@18.2.0/node_modules/@emotion/styled/dist/emotion-styled.browser.esm.js"),emotion_react_browser_esm=__webpack_require__("../node_modules/.pnpm/@emotion+react@11.11.1_@types+react@18.2.22_react@18.2.0/node_modules/@emotion/react/dist/emotion-react.browser.esm.js");!function(S){const shared=emotion_react_browser_esm.iv`
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		position: absolute;
		pointer-events: none;
		transform-origin: 0 0;
		width: 100%;
		height: 100%;
		overflow: visible;
	`;S.DivLayer=emotion_styled_browser_esm.Z.div`
		${shared}
	`,S.SvgLayer=emotion_styled_browser_esm.Z.svg`
		${shared}
	`}(S||(S={}));class TransformLayerWidget extends react.Component{constructor(props){super(props),this.state={}}getTransform(){const model=this.props.layer.getParent();return`\n\t\t\ttranslate(\n\t\t\t\t${model.getOffsetX()}px,\n\t\t\t\t${model.getOffsetY()}px)\n\t\t\tscale(\n\t\t\t\t${model.getZoomLevel()/100}\n\t\t\t)\n  \t`}getTransformStyle(){return this.props.layer.getOptions().transformed?{transform:this.getTransform()}:{}}render(){return this.props.layer.getOptions().isSvg?react.createElement(S.SvgLayer,{style:this.getTransformStyle()},this.props.children):react.createElement(S.DivLayer,{style:this.getTransformStyle()},this.props.children)}}TransformLayerWidget.displayName="TransformLayerWidget";class SmartLayerWidget extends react.Component{shouldComponentUpdate(){return this.props.layer.isRepaintEnabled()}render(){return this.props.engine.getFactoryForLayer(this.props.layer).generateReactWidget({model:this.props.layer})}}SmartLayerWidget.displayName="SmartLayerWidget",function(S){S.Canvas=emotion_styled_browser_esm.Z.div`
		position: relative;
		cursor: move;
		overflow: hidden;
	`}(CanvasWidget_S||(CanvasWidget_S={}));class CanvasWidget extends react.Component{constructor(props){super(props),this.ref=react.createRef(),this.state={action:null,diagramEngineListener:null}}componentWillUnmount(){this.props.engine.deregisterListener(this.canvasListener),this.props.engine.setCanvas(null),document.removeEventListener("keyup",this.keyUp),document.removeEventListener("keydown",this.keyDown)}registerCanvas(){this.props.engine.setCanvas(this.ref.current),this.props.engine.iterateListeners((list=>{list.rendered&&list.rendered()}))}componentDidUpdate(){this.registerCanvas()}componentDidMount(){this.canvasListener=this.props.engine.registerListener({repaintCanvas:()=>{this.forceUpdate()}}),this.keyDown=event=>{this.props.engine.getActionEventBus().fireAction({event})},this.keyUp=event=>{this.props.engine.getActionEventBus().fireAction({event})},document.addEventListener("keyup",this.keyUp),document.addEventListener("keydown",this.keyDown),this.registerCanvas()}render(){const orderedLayers=this.props.engine.getModel().getLayers().sort(((a,b)=>{const order={"diagram-groups":1,"diagram-links":2,"diagram-nodes":3};return order[a.getType()]-order[b.getType()]}));return react.createElement(CanvasWidget_S.Canvas,{className:this.props.className,ref:this.ref,onWheel:event=>{this.props.engine.getActionEventBus().fireAction({event})},onMouseDown:event=>{this.props.engine.getActionEventBus().fireAction({event})},onMouseUp:event=>{this.props.engine.getActionEventBus().fireAction({event})},onMouseMove:event=>{this.props.engine.getActionEventBus().fireAction({event})},onTouchStart:event=>{this.props.engine.getActionEventBus().fireAction({event})},onTouchEnd:event=>{this.props.engine.getActionEventBus().fireAction({event})},onTouchMove:event=>{this.props.engine.getActionEventBus().fireAction({event})}},orderedLayers.map((layer=>react.createElement(TransformLayerWidget,{layer,key:layer.getID()},react.createElement(SmartLayerWidget,{layer,engine:this.props.engine,key:layer.getID()})))))}}CanvasWidget.displayName="CanvasWidget";var SelectionBoxWidget_S,mapValues=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/mapValues.js"),mapValues_default=__webpack_require__.n(mapValues);class LayerModel extends BaseModel{constructor(options={}){super(options),this.models={},this.repaintEnabled=!0}deserialize(event){super.deserialize(event),this.options.isSvg=!!event.data.isSvg,this.options.transformed=!!event.data.transformed,forEach_default()(event.data.models,(model=>{const modelOb=this.getChildModelFactoryBank(event.engine).getFactory(model.type).generateModel({initialConfig:model});modelOb.deserialize(Object.assign(Object.assign({},event),{data:model})),this.addModel(modelOb)}))}serialize(){return Object.assign(Object.assign({},super.serialize()),{isSvg:this.options.isSvg,transformed:this.options.transformed,models:mapValues_default()(this.models,(model=>model.serialize()))})}isRepaintEnabled(){return this.repaintEnabled}allowRepaint(allow=!0){this.repaintEnabled=allow}remove(){this.parent&&this.parent.removeLayer(this),super.remove()}addModel(model){model.setParent(this),this.models[model.getID()]=model}getSelectionEntities(){return flatMap_default()(this.models,(model=>model.getSelectionEntities()))}getModels(){return this.models}getModel(id){return this.models[id]}removeModel(id){const _id="string"==typeof id?id:id.getID();return!!this.models[_id]&&(delete this.models[_id],!0)}}class SelectionLayerModel extends LayerModel{constructor(){super({transformed:!1,isSvg:!1,type:"selection"})}setBox(rect){this.box=rect}getChildModelFactoryBank(){return null}}!function(S){S.Container=emotion_styled_browser_esm.Z.div`
		position: absolute;
		background-color: rgba(0, 192, 255, 0.2);
		border: solid 2px rgb(0, 192, 255);
	`}(SelectionBoxWidget_S||(SelectionBoxWidget_S={}));class SelectionBoxWidget extends react.Component{render(){const{rect}=this.props;return rect?react.createElement(SelectionBoxWidget_S.Container,{style:{top:rect.top,left:rect.left,width:rect.width,height:rect.height}}):null}}SelectionBoxWidget.displayName="SelectionBoxWidget";class SelectionBoxLayerFactory extends AbstractReactFactory{constructor(){super("selection")}generateModel(event){return new SelectionLayerModel}generateReactWidget(event){return react.createElement(SelectionBoxWidget,{rect:event.model.box})}}class PeformanceWidget extends react.Component{shouldComponentUpdate(nextProps,nextState,nextContext){return!this.props.model.performanceTune()||(this.props.model!==nextProps.model||!isEqual_default()(this.props.serialized,nextProps.serialized))}render(){return this.props.children()}}PeformanceWidget.displayName="PeformanceWidget";var intersection=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/intersection.js"),intersection_default=__webpack_require__.n(intersection);class State_State{constructor(options){this.actions=[],this.keys=[],this.childStates=[],this.options=options}setEngine(engine){this.engine=engine}getOptions(){return this.options}eject(){this.engine.getStateMachine().popState()}transitionWithEvent(state,event){this.engine.getStateMachine().pushState(state),this.engine.getActionEventBus().fireAction(event)}registerAction(action){this.actions.push(action)}tryActivateParentState(keys){return this.keys.length>0&&!this.isKeysFullfilled(keys)&&(this.eject(),!0)}tryActivateChildState(keys){const state=this.findStateToActivate(keys);return!!state&&(this.engine.getStateMachine().pushState(state),!0)}findStateToActivate(keys){for(let child of this.childStates)if(child.isKeysFullfilled(keys))return child;return null}isKeysFullfilled(keys){return intersection_default()(this.keys,keys).length===this.keys.length}activated(previous){const keys=this.engine.getActionEventBus().getKeys();if(!this.tryActivateParentState(keys)&&!this.tryActivateChildState(keys)){this.handler1=this.engine.getActionEventBus().registerAction(new Action_Action({type:Action_InputType.KEY_DOWN,fire:()=>{this.tryActivateChildState(this.engine.getActionEventBus().getKeys())}})),this.handler2=this.engine.getActionEventBus().registerAction(new Action_Action({type:Action_InputType.KEY_UP,fire:()=>{this.tryActivateParentState(this.engine.getActionEventBus().getKeys())}}));for(let action of this.actions)this.engine.getActionEventBus().registerAction(action)}}deactivated(next){this.handler1&&this.handler1(),this.handler2&&this.handler2();for(let action of this.actions)this.engine.getActionEventBus().deregisterAction(action)}}class AbstractDisplacementState extends State_State{constructor(options){super(options),this.registerAction(new Action_Action({type:Action_InputType.MOUSE_DOWN,fire:actionEvent=>{const{clientX,clientY}=actionEvent.event;this.handleMoveStart(clientX,clientY)}})),this.registerAction(new Action_Action({type:Action_InputType.MOUSE_MOVE,fire:actionEvent=>{const{event}=actionEvent;if(0===event.buttons)return void this.eject();const{clientX,clientY}=event;this.handleMove(clientX,clientY,event)}})),this.registerAction(new Action_Action({type:Action_InputType.MOUSE_UP,fire:()=>this.handleMoveEnd()})),this.registerAction(new Action_Action({type:Action_InputType.TOUCH_START,fire:actionEvent=>{const{clientX,clientY}=actionEvent.event.touches[0];this.handleMoveStart(clientX,clientY)}})),this.registerAction(new Action_Action({type:Action_InputType.TOUCH_MOVE,fire:actionEvent=>{const{event}=actionEvent,{clientX,clientY}=event.touches[0];this.handleMove(clientX,clientY,event)}})),this.registerAction(new Action_Action({type:Action_InputType.TOUCH_END,fire:()=>this.handleMoveEnd()}))}handleMoveStart(x,y){this.initialX=x,this.initialY=y;const rel=this.engine.getRelativePoint(x,y);this.initialXRelative=rel.x,this.initialYRelative=rel.y}handleMove(x,y,event){this.fireMouseMoved({displacementX:x-this.initialX,displacementY:y-this.initialY,virtualDisplacementX:(x-this.initialX)/(this.engine.getModel().getZoomLevel()/100),virtualDisplacementY:(y-this.initialY)/(this.engine.getModel().getZoomLevel()/100),event})}handleMoveEnd(){this.eject()}}var __awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};class DragCanvasState_DragCanvasState extends AbstractDisplacementState{constructor(options={}){super({name:"drag-canvas"}),this.config=Object.assign({allowDrag:!0},options)}activated(prev){const _super=Object.create(null,{activated:{get:()=>super.activated}});return __awaiter(this,void 0,void 0,(function*(){_super.activated.call(this,prev),this.engine.getModel().clearSelection(),yield this.engine.repaintCanvas(!0);for(let layer of this.engine.getModel().getLayers())layer.allowRepaint(!1);this.initialCanvasX=this.engine.getModel().getOffsetX(),this.initialCanvasY=this.engine.getModel().getOffsetY()}))}deactivated(next){super.deactivated(next);for(let layer of this.engine.getModel().getLayers())layer.allowRepaint(!0)}fireMouseMoved(event){this.config.allowDrag&&(this.engine.getModel().setOffset(this.initialCanvasX+event.displacementX,this.initialCanvasY+event.displacementY),this.engine.repaintCanvas())}}class SelectionBoxState extends AbstractDisplacementState{constructor(){super({name:"selection-box"})}activated(previous){super.activated(previous),this.layer=new SelectionLayerModel,this.engine.getModel().addLayer(this.layer)}deactivated(next){super.deactivated(next),this.layer.remove(),this.engine.repaintCanvas()}getBoxDimensions(event){let rel;if("touches"in event.event){const touch=event.event.touches[0];rel=this.engine.getRelativePoint(touch.clientX,touch.clientY)}else rel=this.engine.getRelativePoint(event.event.clientX,event.event.clientY);return{left:rel.x>this.initialXRelative?this.initialXRelative:rel.x,top:rel.y>this.initialYRelative?this.initialYRelative:rel.y,width:Math.abs(rel.x-this.initialXRelative),height:Math.abs(rel.y-this.initialYRelative),right:rel.x<this.initialXRelative?this.initialXRelative:rel.x,bottom:rel.y<this.initialYRelative?this.initialYRelative:rel.y}}fireMouseMoved(event){this.layer.setBox(this.getBoxDimensions(event));const relative=this.engine.getRelativeMousePoint({clientX:this.initialX,clientY:this.initialY});event.virtualDisplacementX<0&&(relative.x-=Math.abs(event.virtualDisplacementX)),event.virtualDisplacementY<0&&(relative.y-=Math.abs(event.virtualDisplacementY));const rect=dist.Ae.fromPointAndSize(relative,Math.abs(event.virtualDisplacementX),Math.abs(event.virtualDisplacementY));for(let model of this.engine.getModel().getSelectionEntities())if(model.getBoundingBox){const bounds=model.getBoundingBox();rect.containsPoint(bounds.getTopLeft())&&rect.containsPoint(bounds.getBottomRight())?model.setSelected(!0):model.setSelected(!1)}this.engine.repaintCanvas()}}class SelectingState_SelectingState extends State_State{constructor(){super({name:"selecting"}),this.keys=["shift"],this.registerAction(new Action_Action({type:Action_InputType.MOUSE_DOWN,fire:event=>{event.event.preventDefault();const element=this.engine.getActionEventBus().getModelForEvent(event);element?(element.setSelected(!0),this.engine.repaintCanvas()):this.transitionWithEvent(new SelectionBoxState,event)}}))}}class MoveItemsState_MoveItemsState extends AbstractDisplacementState{constructor(){super({name:"move-items"}),this.registerAction(new Action_Action({type:Action_InputType.MOUSE_DOWN,fire:event=>{const element=this.engine.getActionEventBus().getModelForEvent(event);element&&(element.isSelected()||this.engine.getModel().clearSelection(),element.setSelected(!0),this.engine.repaintCanvas())}}))}activated(previous){super.activated(previous),this.initialPositions={}}fireMouseMoved(event){const items=this.engine.getModel().getSelectedEntities(),model=this.engine.getModel();for(let item of items)if(item instanceof BasePositionModel){if(item.isLocked())continue;if(this.initialPositions[item.getID()]||(this.initialPositions[item.getID()]={point:item.getPosition(),item}),"group"in item&&item.group){const group=model.getGroup(item.group);group&&group.adjustSize()}const pos=this.initialPositions[item.getID()].point;item.setPosition(model.getGridPosition(pos.x+event.virtualDisplacementX),model.getGridPosition(pos.y+event.virtualDisplacementY))}this.engine.repaintCanvas()}}},"../packages/react-diagrams-core/dist/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Qo:()=>DefaultDiagramState,Zc:()=>DiagramEngine,Vm:()=>DiagramModel,mk:()=>DragDiagramItemsState,Jq:()=>GroupLayerFactory,dZ:()=>GroupModel,aS:()=>LabelModel,JW:()=>LinkLayerFactory,KW:()=>LinkModel,hL:()=>LinkWidget,JM:()=>NodeLayerFactory,XF:()=>NodeModel,Xs:()=>PointModel,AJ:()=>PortModel,tK:()=>PortModelAlignment,ER:()=>PortWidget});var filter=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/filter.js"),filter_default=__webpack_require__.n(filter),flatMap=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/flatMap.js"),flatMap_default=__webpack_require__.n(flatMap),forEach=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/forEach.js"),forEach_default=__webpack_require__.n(forEach),some=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/some.js"),some_default=__webpack_require__.n(some),values=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/values.js"),values_default=__webpack_require__.n(values),dist=__webpack_require__("../packages/react-canvas-core/dist/index.js");class PointModel extends dist.NW{constructor(options){super(Object.assign(Object.assign({},options),{type:"point"})),this.parent=options.link}isConnectedToPort(){return null!==this.parent.getPortForPoint(this)}getLink(){return this.getParent()}remove(){this.parent&&this.parent.removePoint(this),super.remove()}isLocked(){return super.isLocked()||this.getParent().isLocked()}}var map=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/map.js"),map_default=__webpack_require__.n(map),slice=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/slice.js"),slice_default=__webpack_require__.n(slice),geometry_dist=__webpack_require__("../packages/geometry/dist/index.js");class LinkModel extends dist.gq{constructor(options){super(options),this.points=[new PointModel({link:this}),new PointModel({link:this})],this.sourcePort=null,this.targetPort=null,this.renderedPaths=[],this.labels=[]}getBoundingBox(){return new geometry_dist.Ae((0,geometry_dist.dq)(map_default()(this.points,(point=>point.getPosition()))))}getSelectionEntities(){return this.getTargetPort()&&this.getSourcePort()?super.getSelectionEntities().concat(slice_default()(this.points,1,this.points.length-1)):this.getSourcePort()?this.getTargetPort()?super.getSelectionEntities().concat(this.points):super.getSelectionEntities().concat(slice_default()(this.points,1,this.points.length)):super.getSelectionEntities().concat(slice_default()(this.points,0,this.points.length-1))}deserialize(event){super.deserialize(event),this.points=map_default()(event.data.points||[],(point=>{var p=new PointModel({link:this,position:new geometry_dist.E9(point.x,point.y)});return p.deserialize(Object.assign(Object.assign({},event),{data:point})),p})),forEach_default()(event.data.labels||[],(label=>{let labelOb=event.engine.getFactoryForLabel(label.type).generateModel({});labelOb.deserialize(Object.assign(Object.assign({},event),{data:label})),this.addLabel(labelOb)})),event.data.target&&event.getModel(event.data.targetPort).then((model=>{this.setTargetPort(model)})),event.data.source&&event.getModel(event.data.sourcePort).then((model=>{this.setSourcePort(model)}))}getRenderedPath(){return this.renderedPaths}setRenderedPaths(paths){this.renderedPaths=paths}serialize(){return Object.assign(Object.assign({},super.serialize()),{source:this.sourcePort?this.sourcePort.getParent().getID():null,sourcePort:this.sourcePort?this.sourcePort.getID():null,target:this.targetPort?this.targetPort.getParent().getID():null,targetPort:this.targetPort?this.targetPort.getID():null,points:map_default()(this.points,(point=>point.serialize())),labels:map_default()(this.labels,(label=>label.serialize()))})}doClone(lookupTable={},clone){clone.setPoints(map_default()(this.getPoints(),(point=>point.clone(lookupTable)))),this.sourcePort&&clone.setSourcePort(this.sourcePort.clone(lookupTable)),this.targetPort&&clone.setTargetPort(this.targetPort.clone(lookupTable))}clearPort(port){this.sourcePort===port?this.setSourcePort(null):this.targetPort===port&&this.setTargetPort(null)}remove(){this.sourcePort&&(this.sourcePort.removeLink(this),delete this.sourcePort),this.targetPort&&(this.targetPort.removeLink(this),delete this.targetPort),super.remove()}isLastPoint(point){return this.getPointIndex(point)===this.points.length-1}getPointIndex(point){return this.points.indexOf(point)}getPointModel(id){for(var i=0;i<this.points.length;i++)if(this.points[i].getID()===id)return this.points[i];return null}getPortForPoint(point){return null!==this.sourcePort&&this.getFirstPoint().getID()===point.getID()?this.sourcePort:null!==this.targetPort&&this.getLastPoint().getID()===point.getID()?this.targetPort:null}getPointForPort(port){return null!==this.sourcePort&&this.sourcePort.getID()===port.getID()?this.getFirstPoint():null!==this.targetPort&&this.targetPort.getID()===port.getID()?this.getLastPoint():null}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}setSourcePort(port){null!==port&&port.addLink(this),null!==this.sourcePort&&this.sourcePort.removeLink(this),this.sourcePort=port,this.fireEvent({port},"sourcePortChanged"),(null==port?void 0:port.reportedPosition)&&this.getPointForPort(port).setPosition(port.getCenter())}getSourcePort(){return this.sourcePort}getTargetPort(){return this.targetPort}setTargetPort(port){null!==port&&port.addLink(this),null!==this.targetPort&&this.targetPort.removeLink(this),this.targetPort=port,this.fireEvent({port},"targetPortChanged"),(null==port?void 0:port.reportedPosition)&&this.getPointForPort(port).setPosition(port.getCenter())}point(x,y,index=1){return this.addPoint(this.generatePoint(x,y),index)}addLabel(label){label.setParent(this),this.labels.push(label)}getPoints(){return this.points}getLabels(){return this.labels}setPoints(points){forEach_default()(points,(point=>{point.setParent(this)})),this.points=points}removePoint(pointModel){this.isLastPoint(pointModel)&&this.remove(),this.points.splice(this.getPointIndex(pointModel),1)}removePointsBefore(pointModel){this.points.splice(0,this.getPointIndex(pointModel))}removePointsAfter(pointModel){this.points.splice(this.getPointIndex(pointModel)+1)}removeMiddlePoints(){this.points.length>2&&this.points.splice(1,this.points.length-2)}addPoint(pointModel,index=1){return pointModel.setParent(this),this.points.splice(index,0,pointModel),pointModel}generatePoint(x=0,y=0){return new PointModel({link:this,position:new geometry_dist.E9(x,y)})}}class NodeModel extends dist.NW{constructor(options){super(options),this.ports={},this.width=0,this.height=0,this.group=null}getBoundingBox(){return geometry_dist.Ae.fromPointAndSize(this.getPosition(),this.width,this.height)}setPosition(x,y){const old=this.position;x instanceof geometry_dist.E9?super.setPosition(x):super.setPosition(x,y),forEach_default()(this.ports,(port=>{port.setPosition(port.getX()+this.position.x-old.x,port.getY()+this.position.y-old.y)}))}deserialize(event){super.deserialize(event),forEach_default()(event.data.ports,(port=>{let portOb=event.engine.getFactoryForPort(port.type).generateModel({});portOb.deserialize(Object.assign(Object.assign({},event),{data:port})),event.registerModel(portOb),this.addPort(portOb)}))}serialize(){return Object.assign(Object.assign({},super.serialize()),{ports:map_default()(this.ports,(port=>port.serialize()))})}doClone(lookupTable={},clone){clone.ports={},forEach_default()(this.ports,(port=>{clone.addPort(port.clone(lookupTable))}))}remove(){super.remove(),forEach_default()(this.ports,(port=>{forEach_default()(port.getLinks(),(link=>{link.remove()}))}))}getPortFromID(id){for(var i in this.ports)if(this.ports[i].getID()===id)return this.ports[i];return null}getLink(id){for(let portID in this.ports){const links=this.ports[portID].getLinks();if(links[id])return links[id]}}getPort(name){return this.ports[name]}getPorts(){return this.ports}removePort(port){for(let link of values_default()(port.getLinks()))link.clearPort(port);this.ports[port.getID()]&&(this.ports[port.getID()].setParent(null),delete this.ports[port.getID()])}addPort(port){return port.setParent(this),this.ports[port.getID()]=port,port}updateDimensions({width,height}){this.width=width,this.height=height}}class NodeLayerModel extends dist.iz{constructor(){super({type:"diagram-nodes",isSvg:!1,transformed:!0})}addModel(model){if(!(model instanceof NodeModel))throw new Error("Can only add nodes to this layer");model.registerListener({entityRemoved:()=>{this.getParent().removeNode(model)}}),super.addModel(model)}getChildModelFactoryBank(engine){return engine.getNodeFactories()}getNodes(){return this.getModels()}}class LinkLayerModel extends dist.iz{constructor(){super({type:"diagram-links",isSvg:!0,transformed:!0})}addModel(model){if(!(model instanceof LinkModel))throw new Error("Can only add links to this layer");model.registerListener({entityRemoved:()=>{this.getParent().removeLink(model)}}),super.addModel(model)}getLinks(){return this.getModels()}getChildModelFactoryBank(engine){return engine.getLinkFactories()}}class GroupModel extends dist.NW{constructor(options){super(options),this.calculateBoundingBox=rectangles=>{let minX=1/0,minY=1/0,maxX=-1/0,maxY=-1/0;rectangles.forEach((points=>{minX=Math.min(minX,points[0].x,points[2].x),minY=Math.min(minY,points[0].y,points[2].y),maxX=Math.max(maxX,points[0].x,points[2].x),maxY=Math.max(maxY,points[0].y,points[2].y)}));return{minX,minY,width:maxX-minX,height:maxY-minY}},this.adjustSize=()=>{const nodes=this.getNodes();if(0===Object.keys(nodes).length)return;const rectangles=map_default()(nodes,(node=>node.getBoundingBox().getPoints())),boundingBox=this.calculateBoundingBox(rectangles),currentPosition=this.getPosition(),currentSize=this.getSize(),newLeft=Math.min(currentPosition.x-currentSize.width/2,boundingBox.minX-50),newRight=Math.max(currentPosition.x+currentSize.width/2,boundingBox.minX+boundingBox.width+50),newTop=Math.min(currentPosition.y-currentSize.height/2,boundingBox.minY-50),newBottom=Math.max(currentPosition.y+currentSize.height/2,boundingBox.minY+boundingBox.height+50),newWidth=newRight-newLeft,newHeight=newBottom-newTop,newCenterX=(newLeft+newRight)/2,newCenterY=(newTop+newBottom)/2;this.setPosition(newCenterX,newCenterY),this.setSize({width:newWidth,height:newHeight}),this.fireEvent({width:newWidth,height:newHeight},"sizeChanged")},this.isPointInside=point=>this.getBoundingBox().containsPoint(point),this.nodes={},this.width=0,this.height=0}getBoundingBox(){return geometry_dist.Ae.fromPointAndSize(this.getPosition(),this.width,this.height)}setPosition(x,y,isUpdateNodePosition){const old=this.position;x instanceof geometry_dist.E9?super.setPosition(x):super.setPosition(x,y),0===old.x&&0===old.y||forEach_default()(this.nodes,(node=>{node.setPosition(node.getX()+this.position.x-old.x,node.getY()+this.position.y-old.y)}))}deserialize(event){super.deserialize(event),forEach_default()(event.data.nodes,(node=>{let nodeOb=event.engine.getFactoryForNode(node.type).generateModel({});nodeOb.deserialize(Object.assign(Object.assign({},event),{data:node})),event.registerModel(nodeOb),this.addNode(nodeOb)}))}serialize(){return Object.assign(Object.assign({},super.serialize()),{nodes:map_default()(this.nodes,(node=>node.serialize()))})}remove(){super.remove(),forEach_default()(this.nodes,(node=>{node.remove()}))}getBoundingNodesRect(){return(0,geometry_dist.zh)(Object.values(this.getNodes()).map((node=>node.getBoundingBox())))}getNode(id){return this.nodes[id]}getNodes(){return this.nodes}unGroup(){forEach_default()(this.nodes,(node=>{node.setParent(null),node.group=null})),this.nodes={},this.remove()}doClone(lookupTable={},clone){clone.nodes={},forEach_default()(this.nodes,(node=>{clone.addNode(node.clone(lookupTable))}))}removeNodeFromGroup(nodeID){this.nodes[nodeID]&&(this.nodes[nodeID].setParent(null),delete this.nodes[nodeID]),this.nodes[nodeID].group=null}addNode(node){return node.setParent(this),node.group=this.getID(),this.nodes[node.getID()]=node,node}getSize(){return{width:this.width,height:this.height}}setSize({width,height}){this.width=width,this.height=height}}class GroupLayerModel extends dist.iz{constructor(){super({type:"diagram-groups",isSvg:!0,transformed:!0})}addModel(model){if(!(model instanceof GroupModel))throw new Error("Can only add nodes to this layer");model.registerListener({entityRemoved:()=>{this.getParent().removeGroup(model)}}),super.addModel(model)}getChildModelFactoryBank(engine){return engine.getGroupFactories()}getGroups(){return this.getModels()}}class DiagramModel extends dist.N5{constructor(options={}){super(options),this.addLayer(new LinkLayerModel),this.addLayer(new NodeLayerModel),this.addLayer(new GroupLayerModel)}deserialize(event){this.layers=[],super.deserialize(event)}addLayer(layer){super.addLayer(layer),layer instanceof NodeLayerModel&&(this.activeNodeLayer=layer),layer instanceof LinkLayerModel&&(this.activeLinkLayer=layer),layer instanceof GroupLayerModel&&(this.activeGroupLayer=layer)}getLinkLayers(){return filter_default()(this.layers,(layer=>layer instanceof LinkLayerModel))}getNodeLayers(){return filter_default()(this.layers,(layer=>layer instanceof NodeLayerModel))}getGroupLayers(){return filter_default()(this.layers,(layer=>layer instanceof GroupLayerModel))}getActiveNodeLayer(){if(!this.activeNodeLayer){const layers=this.getNodeLayers();0===layers.length?this.addLayer(new NodeLayerModel):this.activeNodeLayer=layers[0]}return this.activeNodeLayer}getActiveGroupLayer(){if(!this.activeGroupLayer){const layers=this.getGroupLayers();0===layers.length?(this.addLayer(new GroupLayerModel),this.activeGroupLayer=this.getGroupLayers()[0]):this.activeGroupLayer=layers[0]}return this.activeGroupLayer}getActiveLinkLayer(){if(!this.activeLinkLayer){const layers=this.getLinkLayers();0===layers.length?this.addLayer(new LinkLayerModel):this.activeLinkLayer=layers[0]}return this.activeLinkLayer}getNode(node){for(const layer of this.getNodeLayers()){const model=layer.getModel(node);if(model)return model}}getGroup(group){for(const layer of this.getGroupLayers()){const model=layer.getModel(group);if(model)return model}}getLink(link){for(const layer of this.getLinkLayers()){const model=layer.getModel(link);if(model)return model}}addAll(...models){return forEach_default()(models,(model=>{model instanceof LinkModel?this.addLink(model):model instanceof NodeModel?this.addNode(model):model instanceof GroupModel&&this.addGroup(model)})),models}addLink(link){return this.getActiveLinkLayer().addModel(link),this.fireEvent({link,isCreated:!0},"linksUpdated"),link}addGroup(group){return this.getActiveGroupLayer().addModel(group),this.fireEvent({group,isCreated:!0},"groupsUpdated"),group}addNode(node){return this.getActiveNodeLayer().addModel(node),this.fireEvent({node,isCreated:!0},"nodesUpdated"),node}removeLink(link){some_default()(this.getLinkLayers(),(layer=>layer.removeModel(link)))&&this.fireEvent({link,isCreated:!1},"linksUpdated")}removeNode(node){some_default()(this.getNodeLayers(),(layer=>layer.removeModel(node)))&&this.fireEvent({node,isCreated:!1},"nodesUpdated")}removeGroup(group){some_default()(this.getGroupLayers(),(layer=>layer.removeModel(group)))&&this.fireEvent({group,isCreated:!1},"groupsUpdated")}getLinks(){return flatMap_default()(this.getLinkLayers(),(layer=>values_default()(layer.getModels())))}getNodes(){return flatMap_default()(this.getNodeLayers(),(layer=>values_default()(layer.getModels())))}getGroups(){return flatMap_default()(this.getGroupLayers(),(layer=>values_default()(layer.getModels())))}}class LabelModel extends dist.gq{constructor(options){super(Object.assign(Object.assign({},options),{offsetX:options.offsetX||0,offsetY:options.offsetY||0}))}deserialize(event){super.deserialize(event),this.options.offsetX=event.data.offsetX,this.options.offsetY=event.data.offsetY}serialize(){return Object.assign(Object.assign({},super.serialize()),{offsetX:this.options.offsetX,offsetY:this.options.offsetY})}}var S,LinkLayerWidget_S,react=__webpack_require__("../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),emotion_styled_browser_esm=__webpack_require__("../node_modules/.pnpm/@emotion+styled@11.11.0_@emotion+react@11.11.1_@types+react@18.2.22_react@18.2.0__@types+react@18.2.22_react@18.2.0/node_modules/@emotion/styled/dist/emotion-styled.browser.esm.js");!function(S){S.Label=emotion_styled_browser_esm.Z.div`
		display: inline-block;
		position: absolute;
	`,S.Foreign=emotion_styled_browser_esm.Z.foreignObject`
		pointer-events: none;
		overflow: visible;
	`}(S||(S={}));class LabelWidget extends react.Component{constructor(props){super(props),this.findPathAndRelativePositionToRenderLabel=index=>{const link=this.props.label.getParent(),lengths=link.getRenderedPath().map((path=>path.getTotalLength()));let labelPosition=lengths.reduce(((previousValue,currentValue)=>previousValue+currentValue),0)*(index/(link.getLabels().length+1)),pathIndex=0;for(;pathIndex<link.getRenderedPath().length;){if(labelPosition-lengths[pathIndex]<0)return{path:link.getRenderedPath()[pathIndex],position:labelPosition};labelPosition-=lengths[pathIndex],pathIndex++}},this.calculateLabelPosition=()=>{const found=this.findPathAndRelativePositionToRenderLabel(this.props.index+1);if(!found)return;const{path,position}=found,labelDimensions_width=this.ref.current.offsetWidth,labelDimensions_height=this.ref.current.offsetHeight,pathCentre=path.getPointAtLength(position),labelCoordinates_x=pathCentre.x-labelDimensions_width/2+this.props.label.getOptions().offsetX,labelCoordinates_y=pathCentre.y-labelDimensions_height/2+this.props.label.getOptions().offsetY;this.ref.current.style.transform=`translate(${labelCoordinates_x}px, ${labelCoordinates_y}px)`},this.ref=react.createRef()}componentDidUpdate(){window.requestAnimationFrame(this.calculateLabelPosition)}componentDidMount(){window.requestAnimationFrame(this.calculateLabelPosition)}render(){const canvas=this.props.engine.getCanvas();return react.createElement(S.Foreign,{key:this.props.label.getID(),width:null==canvas?void 0:canvas.offsetWidth,height:null==canvas?void 0:canvas.offsetHeight},react.createElement(S.Label,{ref:this.ref},this.props.engine.getFactoryForLabel(this.props.label).generateReactWidget({model:this.props.label})))}}LabelWidget.displayName="LabelWidget";class LinkWidget extends react.Component{constructor(props){super(props),this.state={sourcePort:null,targetPort:null}}componentWillUnmount(){this.sourceListener&&this.sourceListener.deregister(),this.targetListener&&this.targetListener.deregister()}static getDerivedStateFromProps(nextProps,prevState){return{sourcePort:nextProps.link.getSourcePort(),targetPort:nextProps.link.getTargetPort()}}installTarget(){this.targetListener&&this.targetListener.deregister(),this.props.link.getTargetPort()&&(this.targetListener=this.props.link.getTargetPort().registerListener({reportInitialPosition:event=>{this.forceUpdate()}}))}installSource(){this.sourceListener&&this.sourceListener.deregister(),this.props.link.getSourcePort()&&(this.sourceListener=this.props.link.getSourcePort().registerListener({reportInitialPosition:event=>{this.forceUpdate()}}))}componentDidUpdate(prevProps,prevState,snapshot){prevState.sourcePort!==this.state.sourcePort&&this.installSource(),prevState.targetPort!==this.state.targetPort&&this.installTarget()}static generateLinePath(firstPoint,lastPoint){return`M${firstPoint.getX()},${firstPoint.getY()} L ${lastPoint.getX()},${lastPoint.getY()}`}componentDidMount(){this.props.link.getSourcePort()&&this.installSource(),this.props.link.getTargetPort()&&this.installTarget()}render(){const{link}=this.props;return link.getSourcePort()&&!link.getSourcePort().reportedPosition||link.getTargetPort()&&!link.getTargetPort().reportedPosition?null:react.createElement(dist.G,{model:this.props.link,serialized:this.props.link.serialize()},(()=>react.createElement("g",{"data-linkid":this.props.link.getID()},this.props.diagramEngine.generateWidgetForLink(link),map_default()(this.props.link.getLabels(),((labelModel,index)=>react.createElement(LabelWidget,{key:labelModel.getID(),engine:this.props.diagramEngine,label:labelModel,index}))))))}}LinkWidget.displayName="LinkWidget",function(S){S.Container=emotion_styled_browser_esm.Z.div``}(LinkLayerWidget_S||(LinkLayerWidget_S={}));class LinkLayerWidget extends react.Component{render(){return react.createElement(react.Fragment,null,map_default()(this.props.layer.getLinks(),(link=>react.createElement(LinkWidget,{key:link.getID(),link,diagramEngine:this.props.engine}))))}}LinkLayerWidget.displayName="LinkLayerWidget";class LinkLayerFactory extends dist.a3{constructor(){super("diagram-links")}generateModel(event){return new LinkLayerModel}generateReactWidget(event){return react.createElement(LinkLayerWidget,{layer:event.model,engine:this.engine})}}var NodeWidget_S,GroupWidget_S,ResizeObserver_es=__webpack_require__("../node_modules/.pnpm/resize-observer-polyfill@1.5.1/node_modules/resize-observer-polyfill/dist/ResizeObserver.es.js");!function(S){S.Node=emotion_styled_browser_esm.Z.div`
		position: absolute;
		-webkit-touch-callout: none; /* iOS Safari */
		-webkit-user-select: none; /* Chrome/Safari/Opera */
		user-select: none;
		cursor: move;
		pointer-events: all;
	`}(NodeWidget_S||(NodeWidget_S={}));class NodeWidget extends react.Component{constructor(props){super(props),this.ref=react.createRef()}componentWillUnmount(){var _a;this.ob.disconnect(),this.ob=null,null===(_a=this.listener)||void 0===_a||_a.deregister(),this.listener=null}componentDidUpdate(prevProps,prevState,snapshot){this.listener&&this.props.node!==prevProps.node&&(this.listener.deregister(),this.installSelectionListener())}installSelectionListener(){this.listener=this.props.node.registerListener({selectionChanged:event=>{this.forceUpdate()}})}updateSize(width,height){this.props.node.updateDimensions({width,height});try{forEach_default()(this.props.node.getPorts(),(port=>{port.updateCoords(this.props.diagramEngine.getPortCoords(port))}))}catch(ex){}}componentDidMount(){this.ob=new ResizeObserver_es.Z((entities=>{const bounds=entities[0].contentRect;this.updateSize(bounds.width,bounds.height)}));const b=this.ref.current.getBoundingClientRect();this.updateSize(b.width,b.height),this.ob.observe(this.ref.current),this.installSelectionListener()}render(){return react.createElement(dist.G,{model:this.props.node,serialized:this.props.node.serialize()},(()=>react.createElement(NodeWidget_S.Node,{className:"node",ref:this.ref,"data-nodeid":this.props.node.getID(),style:{top:this.props.node.getY(),left:this.props.node.getX()}},this.props.diagramEngine.generateWidgetForNode(this.props.node))))}}NodeWidget.displayName="NodeWidget";class NodeLayerWidget extends react.Component{render(){return react.createElement(react.Fragment,null,map_default()(this.props.layer.getNodes(),(node=>react.createElement(NodeWidget,{key:node.getID(),diagramEngine:this.props.engine,node}))))}}NodeLayerWidget.displayName="NodeLayerWidget";class NodeLayerFactory extends dist.a3{constructor(){super("diagram-nodes")}generateModel(event){return new NodeLayerModel}generateReactWidget(event){return react.createElement(NodeLayerWidget,{layer:event.model,engine:this.engine})}}!function(S){S.Group=emotion_styled_browser_esm.Z.div`
		position: absolute;
		-webkit-touch-callout: none; /* iOS Safari */
		-webkit-user-select: none; /* Chrome/Safari/Opera */
		user-select: none;
		cursor: move;
		pointer-events: all;
	`}(GroupWidget_S||(GroupWidget_S={}));class GroupWidget extends react.Component{constructor(props){super(props),this.ref=react.createRef()}componentWillUnmount(){var _a;null===(_a=this.listener)||void 0===_a||_a.deregister(),this.listener=null}componentDidUpdate(prevProps,prevState,snapshot){this.listener&&this.props.group!==prevProps.group&&(this.listener.deregister(),this.installSelectionListener())}installSelectionListener(){this.listener=this.props.group.registerListener({selectionChanged:event=>{this.forceUpdate()}})}render(){const{group}=this.props,topLeftX=group.getPosition().x-group.getSize().width/2,topLeftY=group.getPosition().y-group.getSize().height/2;return react.createElement(dist.G,{model:this.props.group,serialized:this.props.group.serialize()},(()=>react.createElement("g",{"data-groupid":this.props.group.getID(),transform:`translate(${topLeftX}, ${topLeftY})`},react.createElement("rect",{width:this.props.group.getSize().width+20,height:this.props.group.getSize().height,fill:"transparent",fillOpacity:.1,stroke:"transparent"}),this.props.diagramEngine.generateWidgetForGroup(this.props.group))))}}GroupWidget.displayName="GroupWidget";class GroupLayerWidget extends react.Component{render(){return react.createElement(react.Fragment,null,map_default()(this.props.layer.getGroups(),(group=>react.createElement(GroupWidget,{key:group.getID(),diagramEngine:this.props.engine,group}))))}}GroupLayerWidget.displayName="GroupLayerWidget";class GroupLayerFactory extends dist.a3{constructor(){super("diagram-groups")}generateModel(event){return new GroupLayerModel}generateReactWidget(event){return react.createElement(GroupLayerWidget,{layer:event.model,engine:this.engine})}}var PortModelAlignment,lodash_isFinite=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/isFinite.js"),isFinite_default=__webpack_require__.n(lodash_isFinite),size=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/size.js"),size_default=__webpack_require__.n(size);!function(PortModelAlignment){PortModelAlignment.TOP="top",PortModelAlignment.LEFT="left",PortModelAlignment.BOTTOM="bottom",PortModelAlignment.RIGHT="right"}(PortModelAlignment||(PortModelAlignment={}));class PortModel extends dist.NW{constructor(options){super(options),this.links={},this.reportedPosition=!1}deserialize(event){super.deserialize(event),this.reportedPosition=!1,this.options.name=event.data.name,this.options.alignment=event.data.alignment}serialize(){return Object.assign(Object.assign({},super.serialize()),{name:this.options.name,alignment:this.options.alignment,parentNode:this.parent.getID(),links:map_default()(this.links,(link=>link.getID()))})}setPosition(x,y){let old=this.position;super.setPosition(x,y),forEach_default()(this.getLinks(),(link=>{let point=link.getPointForPort(this);point.setPosition(point.getX()+x-old.x,point.getY()+y-old.y)}))}doClone(lookupTable={},clone){clone.links={},clone.parent=this.getParent().clone(lookupTable)}getNode(){return this.getParent()}getName(){return this.options.name}getMaximumLinks(){return this.options.maximumLinks}setMaximumLinks(maximumLinks){this.options.maximumLinks=maximumLinks}removeLink(link){delete this.links[link.getID()]}addLink(link){this.links[link.getID()]=link}getLinks(){return this.links}createLinkModel(){if(isFinite_default()(this.options.maximumLinks)){var numberOfLinks=size_default()(this.links);if(1===this.options.maximumLinks&&numberOfLinks>=1)return values_default()(this.links)[0];if(numberOfLinks>=this.options.maximumLinks)return null}return null}reportPosition(){forEach_default()(this.getLinks(),(link=>{link.getPointForPort(this).setPosition(this.getCenter())})),this.fireEvent({entity:this},"reportInitialPosition")}getCenter(){return new geometry_dist.E9(this.getX()+this.width/2,this.getY()+this.height/2)}getBoundingBox(){return geometry_dist.Ae.fromPointAndSize(this.position,this.width,this.height)}updateCoords(coords){this.width=coords.getWidth(),this.height=coords.getHeight(),this.setPosition(coords.getTopLeft()),this.reportedPosition=!0,this.reportPosition()}canLinkToPort(port){return!0}isLocked(){return super.isLocked()||this.getParent().isLocked()}}var keys=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/keys.js"),keys_default=__webpack_require__.n(keys);class PortWidget extends react.Component{constructor(props){super(props),this.ref=react.createRef()}report(){this.props.port.updateCoords(this.props.engine.getPortCoords(this.props.port,this.ref.current))}componentWillUnmount(){this.engineListenerHandle&&this.engineListenerHandle.deregister()}componentDidUpdate(prevProps,prevState,snapshot){this.props.port.reportedPosition||this.report()}componentDidMount(){this.engineListenerHandle=this.props.engine.registerListener({canvasReady:()=>{this.report()}}),this.props.engine.getCanvas()&&this.report()}getExtraProps(){var _a;if(dist.C7.TESTING){return{"data-links":keys_default()(null===(_a=this.props.port.getNode().getPort(this.props.port.getName()))||void 0===_a?void 0:_a.links).join(",")}}return{}}render(){return react.createElement("div",Object.assign({style:this.props.style,ref:this.ref,className:`port ${this.props.className||""}`,"data-name":this.props.port.getID(),"data-nodeid":this.props.port.getNode().getID()},this.getExtraProps()),this.props.children)}}PortWidget.displayName="PortWidget";class DragNewLinkState extends dist.s2{constructor(options={}){super({name:"drag-new-link"}),this.config=Object.assign({allowLooseLinks:!0,allowLinksFromLockedPorts:!1},options),this.registerAction(new dist.aU({type:dist.n$.MOUSE_DOWN,fire:event=>{this.port=this.engine.getMouseElement(event.event),this.config.allowLinksFromLockedPorts||!this.port.isLocked()?(this.link=this.port.createLinkModel(),this.link?(this.link.setSelected(!0),this.link.setSourcePort(this.port),this.engine.getModel().addLink(this.link),this.port.reportPosition()):this.eject()):this.eject()}})),this.registerAction(new dist.aU({type:dist.n$.MOUSE_UP,fire:event=>{const model=this.engine.getMouseElement(event.event);if(model instanceof PortModel)return this.port.canLinkToPort(model)?(this.link.setTargetPort(model),model.reportPosition(),void this.engine.repaintCanvas()):(this.link.remove(),void this.engine.repaintCanvas());this.config.allowLooseLinks||(this.link.remove(),this.engine.repaintCanvas())}}))}fireMouseMoved(event){const portPos=this.port.getPosition(),zoomLevelPercentage=this.engine.getModel().getZoomLevel()/100,engineOffsetX=this.engine.getModel().getOffsetX()/zoomLevelPercentage,engineOffsetY=this.engine.getModel().getOffsetY()/zoomLevelPercentage,initialXRelative=this.initialXRelative/zoomLevelPercentage,initialYRelative=this.initialYRelative/zoomLevelPercentage,linkNextX=portPos.x-engineOffsetX+(initialXRelative-portPos.x)+event.virtualDisplacementX,linkNextY=portPos.y-engineOffsetY+(initialYRelative-portPos.y)+event.virtualDisplacementY;this.link.getLastPoint().setPosition(linkNextX,linkNextY),this.engine.repaintCanvas()}}class DragDiagramItemsState extends dist.C2{constructor(){super(),this.registerAction(new dist.aU({type:dist.n$.MOUSE_UP,fire:event=>{const item=this.engine.getMouseElement(event.event);item instanceof PortModel&&forEach_default()(this.initialPositions,(position=>{if(position.item instanceof PointModel){const link=position.item.getParent();if(link.getLastPoint()!==position.item)return;link.getSourcePort().canLinkToPort(item)&&(link.setTargetPort(item),item.reportPosition(),this.engine.repaintCanvas())}}))}}))}}class DefaultDiagramState extends dist.ZM{constructor(){super({name:"default-diagrams"}),this.childStates=[new dist.If],this.dragCanvas=new dist.qR,this.dragNewLink=new DragNewLinkState,this.dragItems=new DragDiagramItemsState,this.registerAction(new dist.aU({type:dist.n$.MOUSE_DOWN,fire:event=>{const element=this.engine.getActionEventBus().getModelForEvent(event);element?element instanceof PortModel?this.transitionWithEvent(this.dragNewLink,event):this.transitionWithEvent(this.dragItems,event):this.transitionWithEvent(this.dragCanvas,event)}})),this.registerAction(new dist.aU({type:dist.n$.TOUCH_START,fire:event=>{this.transitionWithEvent(this.dragCanvas,event)}}))}}class DiagramEngine extends dist.u1{constructor(options={}){super(options),this.maxNumberPointsPerLink=1e3,this.nodeFactories=new dist.r3,this.linkFactories=new dist.r3,this.portFactories=new dist.r3,this.labelFactories=new dist.r3,this.groupFactories=new dist.r3;const setup=factory=>{factory.registerListener({factoryAdded:event=>{event.factory.setDiagramEngine(this)},factoryRemoved:event=>{event.factory.setDiagramEngine(null)}})};setup(this.nodeFactories),setup(this.linkFactories),setup(this.portFactories),setup(this.labelFactories),setup(this.groupFactories)}getMouseElement(event){var element,target=event.target,diagramModel=this.model;if(element=dist.C7.closest(target,"[data-groupid], .group")){const groupElement=element.closest(".group");if(groupElement){const groupId=groupElement.getAttribute("data-groupid");return diagramModel.getGroup(groupId)}}if(element=dist.C7.closest(target,".group-name[data-groupid]"))return console.log("Group name found:",element),diagramModel.getGroup(element.getAttribute("data-groupid"));if(element=dist.C7.closest(target,".port[data-name]")){var nodeElement=dist.C7.closest(target,".node[data-nodeid]");return diagramModel.getNode(nodeElement.getAttribute("data-nodeid")).getPort(element.getAttribute("data-name"))}return(element=dist.C7.closest(target,".point[data-id]"))?diagramModel.getLink(element.getAttribute("data-linkid")).getPointModel(element.getAttribute("data-id")):(element=dist.C7.closest(target,"[data-linkid]"))?diagramModel.getLink(element.getAttribute("data-linkid")):(element=dist.C7.closest(target,".node[data-nodeid]"))?diagramModel.getNode(element.getAttribute("data-nodeid")):null}getNodeFactories(){return this.nodeFactories}getLinkFactories(){return this.linkFactories}getGroupFactories(){return this.groupFactories}getLabelFactories(){return this.labelFactories}getPortFactories(){return this.portFactories}getFactoryForNode(node){return"string"==typeof node?this.nodeFactories.getFactory(node):this.nodeFactories.getFactory(node.getType())}getFactoryForLink(link){return"string"==typeof link?this.linkFactories.getFactory(link):this.linkFactories.getFactory(link.getType())}getFactoryForGroup(group){return"string"==typeof group?this.groupFactories.getFactory(group):this.groupFactories.getFactory(group.getType())}getFactoryForLabel(label){return"string"==typeof label?this.labelFactories.getFactory(label):this.labelFactories.getFactory(label.getType())}getFactoryForPort(port){return"string"==typeof port?this.portFactories.getFactory(port):this.portFactories.getFactory(port.getType())}generateWidgetForLink(link){return this.getFactoryForLink(link).generateReactWidget({model:link})}generateWidgetForGroup(group){return this.getFactoryForGroup(group).generateReactWidget({model:group})}generateWidgetForNode(node){return this.getFactoryForNode(node).generateReactWidget({model:node})}getNodeElement(node){const selector=this.canvas.querySelector(`.node[data-nodeid="${node.getID()}"]`);if(null===selector)throw new Error("Cannot find Node element with nodeID: ["+node.getID()+"]");return selector}getNodePortElement(port){var selector=this.canvas.querySelector(`.port[data-name="${port.getID()}"][data-nodeid="${port.getParent().getID()}"]`);if(null===selector)throw new Error("Cannot find Node Port element with nodeID: ["+port.getParent().getID()+"] and name: ["+port.getName()+"]");return selector}getPortCenter(port){return this.getPortCoords(port).getOrigin()}getPortCoords(port,element){if(!this.canvas)throw new Error("Canvas needs to be set first");element||(element=this.getNodePortElement(port));const sourceRect=element.getBoundingClientRect(),point=this.getRelativeMousePoint({clientX:sourceRect.left,clientY:sourceRect.top}),zoom=this.model.getZoomLevel()/100;return geometry_dist.Ae.fromPointAndSize(point,sourceRect.width/zoom,sourceRect.height/zoom)}getNodeDimensions(node){if(!this.canvas)return{width:0,height:0};const nodeRect=this.getNodeElement(node).getBoundingClientRect();return{width:nodeRect.width,height:nodeRect.height}}getBoundingNodesRect(nodes){if(nodes)return 0===nodes.length?new geometry_dist.Ae:new geometry_dist.Ae((0,geometry_dist.zh)(nodes.map((node=>node.getBoundingBox()))))}zoomToFitSelectedNodes(options){const nodes=this.model.getSelectedEntities().filter((entity=>entity instanceof NodeModel));this.zoomToFitNodes({margin:options.margin,maxZoom:options.maxZoom,nodes:nodes.length>0?nodes:null})}zoomToFitNodes(options){let margin=options||0,nodes=[],maxZoom=null;options&&"object"==typeof options&&(margin=options.margin||0,nodes=options.nodes||[],maxZoom=options.maxZoom||null),0===nodes.length&&(nodes=this.model.getNodes());const nodesRect=this.getBoundingNodesRect(nodes);if(nodesRect){let canvasRect=this.canvas.getBoundingClientRect();const calculate=(margin=0)=>{const xFactor=this.canvas.clientWidth/(nodesRect.getWidth()+2*margin),yFactor=this.canvas.clientHeight/(nodesRect.getHeight()+2*margin);let zoomFactor=xFactor<yFactor?xFactor:yFactor;return maxZoom&&zoomFactor>maxZoom&&(zoomFactor=maxZoom),{zoom:zoomFactor,x:canvasRect.width/2-((nodesRect.getWidth()+2*margin)/2+nodesRect.getTopLeft().x)*zoomFactor+margin,y:canvasRect.height/2-((nodesRect.getHeight()+2*margin)/2+nodesRect.getTopLeft().y)*zoomFactor+margin}};let params=calculate(0);margin&&(params.x<margin||params.y<margin)&&(params=calculate(margin)),this.model.setZoomLevel(100*params.zoom),this.model.setOffset(params.x,params.y),this.repaintCanvas()}}getMaxNumberPointsPerLink(){return this.maxNumberPointsPerLink}setMaxNumberPointsPerLink(max){this.maxNumberPointsPerLink=max}}},"../packages/react-diagrams-defaults/dist/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{uM:()=>DefaultGroupFactory,mZ:()=>DefaultGroupModel,eW:()=>DefaultLabelFactory,Py:()=>DefaultLabelModel,oQ:()=>DefaultLinkFactory,Si:()=>DefaultLinkModel,hb:()=>DefaultLinkPointWidget,AQ:()=>DefaultLinkSegmentWidget,HU:()=>DefaultNodeFactory,Fs:()=>DefaultNodeModel,Q7:()=>DefaultPortFactory,Gi:()=>DefaultPortModel});var react=__webpack_require__("../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),dist=__webpack_require__("../packages/react-diagrams-core/dist/index.js");class DefaultLabelModel extends dist.aS{constructor(options={}){super(Object.assign({offsetY:null==options.offsetY?-23:options.offsetY,type:"default"},options))}setLabel(label){this.options.label=label}deserialize(event){super.deserialize(event),this.options.label=event.data.label}serialize(){return Object.assign(Object.assign({},super.serialize()),{label:this.options.label})}}var S,emotion_styled_browser_esm=__webpack_require__("../node_modules/.pnpm/@emotion+styled@11.10.5_@babel+core@7.22.20_@emotion+react@11.11.1_@types+react@18.2.22_react_pfexgm6nrwjk6kfh2tstbdqjye/node_modules/@emotion/styled/dist/emotion-styled.browser.esm.js");!function(S){S.Label=emotion_styled_browser_esm.Z.div`
		background: rgba(0, 0, 0, 0.8);
		border-radius: 5px;
		color: white;
		font-size: 12px;
		padding: 4px 8px;
		font-family: sans-serif;
		user-select: none;
	`}(S||(S={}));class DefaultLabelWidget extends react.Component{render(){return react.createElement(S.Label,null,this.props.model.getOptions().label)}}DefaultLabelWidget.displayName="DefaultLabelWidget";var react_canvas_core_dist=__webpack_require__("../packages/react-canvas-core/dist/index.js");class DefaultLabelFactory extends react_canvas_core_dist.a3{constructor(){super("default")}generateReactWidget(event){return react.createElement(DefaultLabelWidget,{model:event.model})}generateModel(event){return new DefaultLabelModel}}var DefaultLinkPointWidget_S,geometry_dist=__webpack_require__("../packages/geometry/dist/index.js");class DefaultLinkModel extends dist.KW{constructor(options={}){var _a,_b;super(Object.assign({type:"default",width:options.width||3,color:options.color||"black",selectedColor:options.selectedColor||"rgb(0,192,255)",curvyness:50},options)),this.options.color=(null===(_a=this.targetPort)||void 0===_a?void 0:_a.getOptions().icon_color)||(null===(_b=this.sourcePort)||void 0===_b?void 0:_b.getOptions().icon_color)||options.color||"black"}calculateControlOffset(port){return port.getOptions().alignment===dist.tK.RIGHT?[this.options.curvyness,0]:port.getOptions().alignment===dist.tK.LEFT?[-this.options.curvyness,0]:port.getOptions().alignment===dist.tK.TOP?[0,-this.options.curvyness]:[0,this.options.curvyness]}getSVGPath(){if(2===this.points.length){const curve=new geometry_dist.hr,padding=0;let sourcePosition=this.getFirstPoint().getPosition().clone(),targetPosition=this.getLastPoint().getPosition().clone();if(this.sourcePort){const adjustedSource=this.adjustPositionForPadding(this.getSourcePort(),this.getFirstPoint(),padding);sourcePosition.x=adjustedSource.x,sourcePosition.y=adjustedSource.y}if(this.targetPort){const adjustedTarget=this.adjustPositionForPadding(this.getTargetPort(),this.getLastPoint(),padding);targetPosition.x=adjustedTarget.x,targetPosition.y=adjustedTarget.y}return curve.setSource(sourcePosition),curve.setTarget(targetPosition),curve.setSourceControl(sourcePosition.clone()),curve.setTargetControl(targetPosition.clone()),this.sourcePort&&curve.getSourceControl().translate(...this.calculateControlOffset(this.getSourcePort())),this.targetPort&&curve.getTargetControl().translate(...this.calculateControlOffset(this.getTargetPort())),curve.getSVGCurve()}}serialize(){return Object.assign(Object.assign({},super.serialize()),{width:this.options.width,color:this.options.color,curvyness:this.options.curvyness,selectedColor:this.options.selectedColor})}deserialize(event){super.deserialize(event),this.options.color=event.data.color,this.options.width=event.data.width,this.options.curvyness=event.data.curvyness,this.options.selectedColor=event.data.selectedColor}addLabel(label){if(label instanceof dist.aS)return super.addLabel(label);let labelOb=new DefaultLabelModel;return labelOb.setLabel(label),super.addLabel(labelOb)}setWidth(width){this.options.width=width,this.fireEvent({width},"widthChanged")}setColor(color){this.options.color=color,this.fireEvent({color},"colorChanged")}adjustPositionForPadding(port,point,padding){const position=point.getPosition(),alignment=port.getOptions().alignment;let x=position.x,y=position.y;return alignment===dist.tK.RIGHT?x-=padding:alignment===dist.tK.LEFT?x+=padding:alignment===dist.tK.TOP?y+=padding:alignment===dist.tK.BOTTOM&&(y-=padding),{x,y}}}!function(S){S.PointTop=emotion_styled_browser_esm.Z.circle`
		pointer-events: all;
	`}(DefaultLinkPointWidget_S||(DefaultLinkPointWidget_S={}));class DefaultLinkPointWidget extends react.Component{constructor(props){super(props),this.state={selected:!1}}render(){const{point}=this.props;return react.createElement("g",null,react.createElement("circle",{cx:point.getPosition().x,cy:point.getPosition().y,r:5,fill:this.state.selected||this.props.point.isSelected()?this.props.colorSelected:this.props.color}),react.createElement(DefaultLinkPointWidget_S.PointTop,{className:"point",onMouseLeave:()=>{this.setState({selected:!1})},onMouseEnter:()=>{this.setState({selected:!0})},"data-id":point.getID(),"data-linkid":point.getLink().getID(),cx:point.getPosition().x,cy:point.getPosition().y,r:15,opacity:0}))}}DefaultLinkPointWidget.displayName="DefaultLinkPointWidget";class DefaultLinkSegmentWidget extends react.Component{render(){const Bottom=react.cloneElement(this.props.factory.generateLinkSegment(this.props.link,this.props.selected||this.props.link.isSelected(),this.props.path),{ref:this.props.forwardRef}),Top=react.cloneElement(Bottom,Object.assign(Object.assign({strokeLinecap:"round",onMouseLeave:()=>{this.props.onSelection(!1)},onMouseEnter:()=>{this.props.onSelection(!0)}},this.props.extras),{ref:null,"data-linkid":this.props.link.getID(),strokeOpacity:this.props.selected?.1:0,strokeWidth:20,fill:"none",onContextMenu:()=>{this.props.link.isLocked()||(event.preventDefault(),this.props.link.remove())}}));return react.createElement("g",null,Bottom,Top)}}DefaultLinkSegmentWidget.displayName="DefaultLinkSegmentWidget";const DefaultLinkWidget=props=>{const[selected,setSelected]=react.useState(!1),refPaths=(0,react.useRef)([]);(0,react.useEffect)((()=>(props.link.setRenderedPaths(refPaths.current.map((ref=>ref.current)).filter(Boolean)),()=>{props.link.setRenderedPaths([])})),[props.link]);const generateRef=()=>{const ref=react.createRef();return refPaths.current.push(ref),ref},addPointToLink=(event,index)=>{if(!event.shiftKey&&!props.link.isLocked()&&props.link.getPoints().length-1<=props.diagramEngine.getMaxNumberPointsPerLink()){const position=props.diagramEngine.getRelativeMousePoint(event),point=props.link.point(position.x,position.y,index);event.persist(),event.stopPropagation(),props.diagramEngine.getActionEventBus().fireAction({event,model:point})}},generatePoint=point=>{var _a;return react.createElement(DefaultLinkPointWidget,{key:point.getID(),point,colorSelected:null!==(_a=props.link.getOptions().selectedColor)&&void 0!==_a?_a:"",color:props.link.getOptions().color})},generateLink=(path,extraProps,id)=>react.createElement(DefaultLinkSegmentWidget,{key:`link-${id}`,path,selected,diagramEngine:props.diagramEngine,factory:props.diagramEngine.getFactoryForLink(props.link),link:props.link,forwardRef:generateRef(),onSelection:setSelected,extras:extraProps}),points=props.link.getPoints(),paths=[];if(refPaths.current=[],2===points.length)paths.push(generateLink(props.link.getSVGPath(),{onMouseDown:event=>{var _a;null===(_a=props.selected)||void 0===_a||_a.call(props,event),addPointToLink(event,1)}},"0")),null==props.link.getTargetPort()&&paths.push(generatePoint(points[1]));else{for(let j=0;j<points.length-1;j++)paths.push(generateLink(dist.hL.generateLinePath(points[j],points[j+1]),{"data-linkid":props.link.getID(),"data-point":j,onMouseDown:event=>{var _a;null===(_a=props.selected)||void 0===_a||_a.call(props,event),addPointToLink(event,j+1)}},j));if(null===(_a=props.renderPoints)||void 0===_a||_a){for(let i=1;i<points.length-1;i++)paths.push(generatePoint(points[i]));null==props.link.getTargetPort()&&paths.push(generatePoint(points[points.length-1]))}}var _a;return react.createElement("g",{"data-default-link-test":props.link.getOptions().testName},paths)};var DefaultLinkFactory_S,emotion_react_browser_esm=__webpack_require__("../node_modules/.pnpm/@emotion+react@11.11.1_@types+react@18.2.22_react@18.2.0/node_modules/@emotion/react/dist/emotion-react.browser.esm.js");!function(S){S.Keyframes=emotion_react_browser_esm.F4`
		from {
			stroke-dashoffset: 24;
		}
		to {
			stroke-dashoffset: 0;
		}
	`;const selected=emotion_react_browser_esm.iv`
		stroke-dasharray: 10, 2;
		animation: ${S.Keyframes} 1s linear infinite;
	`;S.Path=emotion_styled_browser_esm.Z.path`
		${p=>p.selected&&selected};
		fill: none;
		pointer-events: auto;
	`}(DefaultLinkFactory_S||(DefaultLinkFactory_S={}));class DefaultLinkFactory extends react_canvas_core_dist.a3{constructor(type="default"){super(type)}generateReactWidget(event){return react.createElement(DefaultLinkWidget,{link:event.model,diagramEngine:this.engine})}generateModel(event){return new DefaultLinkModel}generateLinkSegment(model,selected,path){return react.createElement(DefaultLinkFactory_S.Path,{selected,stroke:selected?model.getOptions().selectedColor:model.getOptions().color,strokeWidth:model.getOptions().width,d:path})}}var map=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/map.js"),map_default=__webpack_require__.n(map);class DefaultPortModel extends dist.AJ{constructor(options,name,label,icon,icon_color){"boolean"==typeof options&&(options={in:options,name,label,icon:icon||"round",icon_color:icon_color||"#000000"}),super(Object.assign({label:options.label||options.name,alignment:options.in?dist.tK.LEFT:dist.tK.RIGHT,type:"default",icon:options.icon||"round",icon_color:options.icon_color||"#000000"},options))}deserialize(event){super.deserialize(event),this.options.in=event.data.in,this.options.label=event.data.label,this.options.icon=event.data.icon,this.options.icon_color=event.data.icon_color}serialize(){return Object.assign(Object.assign({},super.serialize()),{in:this.options.in,label:this.options.label,icon:this.options.icon||"round",icon_color:this.options.icon_color||"#000000"})}link(port,factory){let link=this.createLinkModel(factory);return link.setSourcePort(this),link.setTargetPort(port),link}canLinkToPort(port){const links=Object.values(port.getLinks());let canConnect=this.getID()!==port.getID()&&this.getParent().getID()!==port.getParent().getID();return canConnect&&(0===links.length?canConnect=!0:links.forEach((link=>{const targetPort=link.getTargetPort(),sourcePort=link.getSourcePort();((null==targetPort?void 0:targetPort.getID())===(null==port?void 0:port.getID())&&(null==sourcePort?void 0:sourcePort.getID())===(null==this?void 0:this.getID())||(null==sourcePort?void 0:sourcePort.getID())===(null==port?void 0:port.getID())&&(null==targetPort?void 0:targetPort.getID())===(null==this?void 0:this.getID()))&&(canConnect=!1),targetPort||(canConnect=!1)}))),canConnect}setLabel(value){this.options.label=value}createLinkModel(factory){let link=super.createLinkModel();return!link&&factory?factory.generateModel({}):link||new DefaultLinkModel}}class DefaultNodeModel extends dist.XF{constructor(options={},color){"string"==typeof options&&(options={name:options,color}),super(Object.assign({type:"default",name:"Untitled",color:"rgb(0,192,255)",sub:"sub title",shape:!1},options)),this.portsOut=[],this.portsIn=[],this.shape="string"!=typeof options&&void 0!==options.shape&&Boolean(options.shape),this.sub=this.options.sub}doClone(lookupTable,clone){clone.portsIn=[],clone.portsOut=[],super.doClone(lookupTable,clone)}removePort(port){super.removePort(port),port.getOptions().in?this.portsIn.splice(this.portsIn.indexOf(port),1):this.portsOut.splice(this.portsOut.indexOf(port),1)}addPort(port){return super.addPort(port),port.getOptions().in?-1===this.portsIn.indexOf(port)&&this.portsIn.push(port):-1===this.portsOut.indexOf(port)&&this.portsOut.push(port),port}addInPort(label,after=!0){const p=new DefaultPortModel({in:!0,name:label,label,alignment:dist.tK.LEFT});return after||this.portsIn.splice(0,0,p),this.addPort(p)}addOutPort(label,after=!0){const p=new DefaultPortModel({in:!1,name:label,label,alignment:dist.tK.RIGHT});return after||this.portsOut.splice(0,0,p),this.addPort(p)}deserialize(event){super.deserialize(event),this.options.name=event.data.name,this.options.color=event.data.color,this.options.sub=event.data.sub,this.shape=event.data.shape,this.portsIn=map_default()(event.data.portsInOrder,(id=>this.getPortFromID(id))),this.portsOut=map_default()(event.data.portsOutOrder,(id=>this.getPortFromID(id)))}serialize(){return Object.assign(Object.assign({},super.serialize()),{name:this.options.name,color:this.options.color,shape:this.shape,sub:this.options.sub,portsInOrder:map_default()(this.portsIn,(port=>port.getID())),portsOutOrder:map_default()(this.portsOut,(port=>port.getID()))})}getInPorts(){return this.portsIn}changeShape(value){this.shape=Boolean(value)}getShape(){return this.shape}changeOptions(key,value){this.options[key]=value}setName(value){this.options.name=value}getOutPorts(){return this.portsOut}getSize(){return{width:this.width,height:this.height}}setGroupId(groupId){this.groupId=groupId}getGroupId(){return this.groupId}}const Triangle=({color})=>react.createElement("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},react.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.60364 5.1467L3.52164 1.4302C2.85514 1.0227 2.00014 1.5022 2.00014 2.2832L2.00014 9.7172C2.00014 10.4982 2.85514 10.9777 3.52164 10.5707L9.60364 6.8537C10.2421 6.4637 10.2421 5.5367 9.60364 5.1467Z",fill:color,stroke:color,strokeLinecap:"round",strokeLinejoin:"round"})),Rhombus=({color})=>react.createElement("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},react.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.35216 10.3488L1.65116 6.64784C1.29316 6.28984 1.29316 5.70934 1.65116 5.35134L5.35216 1.65034C5.71016 1.29234 6.29066 1.29234 6.64866 1.65034L10.3497 5.35134C10.7077 5.70934 10.7077 6.28984 10.3497 6.64784L6.64866 10.3488C6.29016 10.7068 5.71016 10.7068 5.35216 10.3488Z",fill:color,stroke:color,strokeLinecap:"round",strokeLinejoin:"round"})),Round=({color})=>react.createElement("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},react.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.18198 9.18197C7.42462 10.9393 4.57538 10.9393 2.81803 9.18197C1.06067 7.42461 1.06067 4.57537 2.81803 2.81802C4.57539 1.06066 7.42463 1.06066 9.18198 2.81802C10.9393 4.57538 10.9393 7.42462 9.18198 9.18197Z",fill:color}),react.createElement("path",{d:"M9.18198 9.18197C7.42462 10.9393 4.57538 10.9393 2.81803 9.18197C1.06067 7.42461 1.06067 4.57537 2.81803 2.81802C4.57539 1.06066 7.42463 1.06066 9.18198 2.81802C10.9393 4.57538 10.9393 7.42462 9.18198 9.18197",stroke:color,strokeLinecap:"round",strokeLinejoin:"round"}));var DefaultPortLabelWidget_S,DefaultNodeWidget_S;!function(S){S.PortLabel=emotion_styled_browser_esm.Z.div`
		display: flex;
		margin-top: 1px;
		align-items: center;
	`,S.Label=emotion_styled_browser_esm.Z.div`
		padding: 0 5px;
		flex-grow: 1;
		display: flex;
		align-items: center;

		input {
			background-color: 'white';
			border: none;
			outline: none;
			padding: 8px;
			font-size: 14px;
			color: black;
			width: 100%;
			cursor: text;
		}
	`,S.Port=emotion_styled_browser_esm.Z.div`
		width: 15px;
		height: 15px;
		display: flex;
		justify-content: center;
		align-items: center;
		${({isIn})=>isIn?"margin-left: 5px;":"margin-right: 5px;"}
		&:hover {
			background: rgb(192, 255, 0);
		}
	`}(DefaultPortLabelWidget_S||(DefaultPortLabelWidget_S={}));class DefaultPortLabel extends react.Component{constructor(props){super(props),this.calculateInputWidth=value=>8*(value.length+1)+"px",this.handleNameChange=event=>{const newName=event.target.value;this.setState({portName:newName,inputWidth:this.calculateInputWidth(newName)}),this.props.port.setLabel(newName)},this.renderPortIcon=(icon,color)=>{switch(icon){case"triangle":return react.createElement(Triangle,{color});case"rhombus":return react.createElement(Rhombus,{color});case"round":return react.createElement(Round,{color});default:return null}},this.state={portName:props.port.getOptions().name,inputWidth:this.calculateInputWidth(props.port.getOptions().name)}}render(){const port=react.createElement(dist.ER,{engine:this.props.engine,port:this.props.port},react.createElement(DefaultPortLabelWidget_S.Port,{isIn:this.props.port.getOptions().in},this.renderPortIcon(this.props.port.getOptions().icon,this.props.port.getOptions().icon_color))),label=react.createElement(DefaultPortLabelWidget_S.Label,null,react.createElement("input",{type:"text",value:this.props.port.getOptions().label,onChange:this.handleNameChange,onFocus:()=>this.props.engine.getModel().setEdited(!0),onBlur:()=>this.props.engine.getModel().setEdited(!1),readOnly:!0}));return react.createElement(DefaultPortLabelWidget_S.PortLabel,null,this.props.port.getOptions().in?port:label,this.props.port.getOptions().in?label:port)}}DefaultPortLabel.displayName="DefaultPortLabel",function(S){S.Node=emotion_styled_browser_esm.Z.div`
		background-color: ${p=>p.background};
		border-radius: ${p=>"true"===p.shape?"16px":"unset"};
		font-family: sans-serif;
		color: white;
		overflow: visible;
		font-size: 14px;
		line-height: 20px;
		padding: 10px;
		width: 203px;
	`,S.Title=emotion_styled_browser_esm.Z.div`
		display: flex;
		white-space: nowrap;
		justify-items: center;
	`,S.Icon=emotion_styled_browser_esm.Z.div`
		padding: 8px;
	`,S.TitleWrapper=emotion_styled_browser_esm.Z.div`
		flex-grow: 1;
		padding: 5px 5px;
		display: flex;
		flex-direction: column;
		input {
			background-color: ${p=>p.background};
			border: none;
			outline: none;
			padding-left: 5px;
			color: white;
			cursor: text;
			text-overflow: ellipsis;
		}
	`,S.TitleName=emotion_styled_browser_esm.Z.div`
		input {
			font-size: 14px;
			font-weight: bold;
		}
	`,S.Ports=emotion_styled_browser_esm.Z.div`
		display: flex;
		background-color: white;
		border-radius: 8px;
	`,S.PortsContainer=emotion_styled_browser_esm.Z.div`
		max-width: 50%;
		flex-basis: 50%;
		display: flex;
		flex-direction: column;
		align-items: ${p=>p.isIn?"flex-start":"flex-end"};
		&:first-of-type {
			margin-right: 10px;
		}

		&:only-child {
			margin-right: 0px;
		}
	`,S.InputWrapper=emotion_styled_browser_esm.Z.div`
		position: relative;

		&:before {
			content: attr(data-tooltip);
			position: absolute;
			bottom: 100%;
			left: 0;
			padding: 5px 10px;
			background: rgba(0, 0, 0, 0.8);
			color: white;
			border-radius: 4px;
			font-size: 12px;
			max-width: 178px;
			opacity: 0;
			visibility: hidden;
			transition: opacity 0.2s;
			pointer-events: none;
			z-index: 1000;
			margin-bottom: 5px;
			max-width: 300px;
			overflow: hidden;
			text-overflow: ellipsis;

			display: -webkit-box;
			-webkit-line-clamp: 3;
			-webkit-box-orient: vertical;
			line-height: 1.4;
			max-height: calc(1.4em * 3);
			word-break: break-word;
		}

		&:hover:before {
			opacity: 1;
			visibility: visible;
			transition-delay: 2s;
		}
	`,S.SelectionBox=emotion_styled_browser_esm.Z.div`
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		pointer-events: none;

		// Border trên
		.border-top {
			position: absolute;
			top: -4px;
			left: -2px;
			right: -2px;
			height: 1px;
			background: #ff5722;
		}

		// Border phải
		.border-right {
			position: absolute;
			top: -2px;
			right: -4px;
			bottom: -2px;
			width: 1px;
			background: #ff5722;
		}

		// Border dưới
		.border-bottom {
			position: absolute;
			bottom: -4px;
			left: -2px;
			right: -2px;
			height: 1px;
			background: #ff5722;
		}

		// Border trái
		.border-left {
			position: absolute;
			top: -2px;
			left: -4px;
			bottom: -2px;
			width: 1px;
			background: #ff5722;
		}

		// Style cho 4 điểm góc
		.corner {
			position: absolute;
			width: 4px;
			height: 4px;
			background: transparent;
			border: 1px solid #ff5722;
			border-radius: 50%;

			&.top-left {
				top: -4px;
				left: -4px;
				transform: translate(-50%, -50%);
			}

			&.top-right {
				top: -4px;
				right: -4px;
				transform: translate(50%, -50%);
			}

			&.bottom-left {
				bottom: -4px;
				left: -4px;
				transform: translate(-50%, 50%);
			}

			&.bottom-right {
				bottom: -4px;
				right: -4px;
				transform: translate(50%, 50%);
			}
		}
	`}(DefaultNodeWidget_S||(DefaultNodeWidget_S={}));class DefaultNodeWidget extends react.Component{constructor(props){super(props),this.calculateInputWidth=value=>8*(value.length+1)+"px",this.handleNameChange=event=>{const newName=event.target.value;this.setState({nodeName:newName,inputWidth:this.calculateInputWidth(newName)}),this.props.node.setName(newName)},this.handleChangeSub=event=>{const subTitle=event.target.value;this.setState({subTitle}),this.props.node.changeOptions("sub",subTitle)},this.generatePort=port=>react.createElement(DefaultPortLabel,{engine:this.props.engine,port,key:port.getID()}),this.state={nodeName:props.node.getOptions().name,subTitle:props.node.getOptions().sub,inputWidth:this.calculateInputWidth(props.node.getOptions().name)}}render(){const shape=this.props.node.getShape();return react.createElement(DefaultNodeWidget_S.Node,{"data-default-node-name":this.props.node.getOptions().name,selected:this.props.node.isSelected(),background:this.props.node.getOptions().color,shape:shape.toString()},react.createElement("div",{className:"border-bottom"}),react.createElement("div",{className:"border-left"}),react.createElement("div",{className:"corner top-left"}),react.createElement("div",{className:"corner top-right"}),react.createElement("div",{className:"corner bottom-left"}),react.createElement("div",{className:"corner bottom-right"}),react.createElement(DefaultNodeWidget_S.Title,null,this.props.node.getOptions().icon&&react.createElement(DefaultNodeWidget_S.Icon,null,this.props.node.getOptions().icon),react.createElement(DefaultNodeWidget_S.TitleWrapper,{background:this.props.node.getOptions().color},react.createElement(DefaultNodeWidget_S.TitleName,null,react.createElement(DefaultNodeWidget_S.InputWrapper,{"data-tooltip":this.props.node.getOptions().name},react.createElement("input",{type:"text",value:this.props.node.getOptions().name,onChange:this.handleNameChange,onFocus:()=>this.props.engine.getModel().setEdited(!0),onBlur:()=>this.props.engine.getModel().setEdited(!1),readOnly:!0}))),react.createElement("div",null,react.createElement(DefaultNodeWidget_S.InputWrapper,{"data-tooltip":this.props.node.getOptions().sub},react.createElement("input",{type:"text",value:this.props.node.getOptions().sub,onChange:this.handleChangeSub,onFocus:()=>this.props.engine.getModel().setEdited(!0),onBlur:()=>this.props.engine.getModel().setEdited(!1),readOnly:!0}))))),react.createElement(DefaultNodeWidget_S.Ports,null,react.createElement(DefaultNodeWidget_S.PortsContainer,{isIn:!0},map_default()(this.props.node.getInPorts(),this.generatePort)),react.createElement(DefaultNodeWidget_S.PortsContainer,{isIn:!1},map_default()(this.props.node.getOutPorts(),this.generatePort))),this.props.node.isSelected()&&react.createElement(DefaultNodeWidget_S.SelectionBox,null,react.createElement("div",{className:"border-top"}),react.createElement("div",{className:"border-right"}),react.createElement("div",{className:"border-bottom"}),react.createElement("div",{className:"border-left"}),react.createElement("div",{className:"corner top-left"}),react.createElement("div",{className:"corner top-right"}),react.createElement("div",{className:"corner bottom-left"}),react.createElement("div",{className:"corner bottom-right"})))}}DefaultNodeWidget.displayName="DefaultNodeWidget";class DefaultNodeFactory extends react_canvas_core_dist.a3{constructor(){super("default")}generateReactWidget(event){return react.createElement(DefaultNodeWidget,{engine:this.engine,node:event.model})}generateModel(event){return new DefaultNodeModel}}class DefaultPortFactory extends react_canvas_core_dist.Zi{constructor(){super("default")}generateModel(){return new DefaultPortModel({name:"unknown"})}}class DefaultGroupModel extends dist.dZ{constructor(options={}){"string"==typeof options&&(options={name:options}),super(Object.assign({type:"default",name:"Group",color:"rgb(0,192,255)"},options)),this.nodesList=[]}getName(){return this.options.name}getNodesList(){return this.nodesList}setName(name){this.options.name=name}setColor(color){this.options.color=color,this.fireEvent({color},"colorChanged")}getColor(){return this.options.color}addNode(node){if(node.getParent()!==this){if(node.getParent()instanceof dist.dZ)throw new Error("Can only add nodes to this layer");super.addNode(node),this.nodesList.push(node)}return node}addNodes(nodes){if(nodes.some((node=>node.groupId)))throw new Error("Had node already has a group");nodes.forEach((node=>{this.addNode(node)})),this.adjustSize()}removeNode(node){this.nodesList=this.nodesList.filter((n=>n!==node)),node.setParent(null),this.adjustSize()}unGroup(){this.nodesList.forEach((node=>{node.setParent(null),node.group=null})),this.nodesList=[],super.unGroup()}addLink(link){return this.links.includes(link)||(this.links.push(link),link.setParent(this)),link}removeLink(link){this.links=this.links.filter((l=>l!==link)),link.setParent(null)}getLinks(){return this.links}deserialize(event){super.deserialize(event),this.options.name=event.data.name,this.options.color=event.data.color,this.nodesList=Object.values(event.data.nodes),this.width=event.data.width,this.height=event.data.height}serialize(){return Object.assign(Object.assign({},super.serialize()),{name:this.options.name,color:this.options.color,width:this.width,height:this.height,nodes:map_default()(this.nodesList,(node=>node.serialize()))})}}const DefaultGroupWidget=({group,engine})=>{const[isEditing,setIsEditing]=react.useState(!1),[groupName,setGroupName]=react.useState(group.getName()),{width,height}=group.getSize(),{x,y}=group.getPosition(),NODE_PADDING={top:40,right:20,bottom:20,left:20},GROUP_PADDING=5,adjustNodesPosition=(nodes,groupBounds)=>{const safeGroupBounds_left=groupBounds.left+GROUP_PADDING,safeGroupBounds_right=groupBounds.right-GROUP_PADDING,safeGroupBounds_top=groupBounds.top+GROUP_PADDING,safeGroupBounds_bottom=groupBounds.bottom-GROUP_PADDING;nodes.forEach((node=>{const nodeBoundsWithPadding=(node=>{const bounds=node.getBoundingBox();return{left:bounds.getLeft()-NODE_PADDING.left,right:bounds.getRight()+NODE_PADDING.right,top:bounds.getTop()-NODE_PADDING.top,bottom:bounds.getBottom()+NODE_PADDING.bottom}})(node);let newX=node.getPosition().x,newY=node.getPosition().y;nodeBoundsWithPadding.left<safeGroupBounds_left&&(newX+=safeGroupBounds_left-nodeBoundsWithPadding.left),nodeBoundsWithPadding.right>safeGroupBounds_right&&(newX-=nodeBoundsWithPadding.right-safeGroupBounds_right),nodeBoundsWithPadding.top<safeGroupBounds_top&&(newY+=safeGroupBounds_top-nodeBoundsWithPadding.top),nodeBoundsWithPadding.bottom>safeGroupBounds_bottom&&(newY-=nodeBoundsWithPadding.bottom-safeGroupBounds_bottom);const newBounds=geometry_dist.Ae.fromPointAndSize(new geometry_dist.E9(newX,newY),node.width,node.height);if(newBounds.getLeft()>=safeGroupBounds_left&&newBounds.getRight()<=safeGroupBounds_right&&newBounds.getTop()>=safeGroupBounds_top&&newBounds.getBottom()<=safeGroupBounds_bottom)node.setPosition(newX,newY);else{const centerX=(safeGroupBounds_left+safeGroupBounds_right)/2,centerY=(safeGroupBounds_top+safeGroupBounds_bottom)/2;node.setPosition(centerX,centerY)}}))},handleResize=direction=>event=>{event.stopPropagation(),event.preventDefault();let isResizing=!0;const startX=event.clientX,startY=event.clientY,startWidth=group.getSize().width,startHeight=group.getSize().height,startPos=group.getPosition(),nodes=Object.values(group.getNodes()),{minWidth,minHeight}=(nodes=>{if(!nodes.length)return{minWidth:100,minHeight:100};const maxNodeSize=nodes.reduce(((max,node)=>{const bounds=node.getBoundingBox();return{width:Math.max(max.width,bounds.getRight()-bounds.getLeft()+NODE_PADDING.left+NODE_PADDING.right),height:Math.max(max.height,bounds.getBottom()-bounds.getTop()+NODE_PADDING.top+NODE_PADDING.bottom)}}),{width:0,height:0});return{minWidth:1.5*maxNodeSize.width+2*GROUP_PADDING,minHeight:1.5*maxNodeSize.height+2*GROUP_PADDING}})(nodes),handleMouseMove=moveEvent=>{if(!isResizing)return;const deltaX=moveEvent.clientX-startX,deltaY=moveEvent.clientY-startY;let newWidth=startWidth,newHeight=startHeight,newX=startPos.x,newY=startPos.y;switch(direction){case"se":newWidth=Math.max(minWidth,startWidth+deltaX),newHeight=Math.max(minHeight,startHeight+deltaY);break;case"sw":newWidth=Math.max(minWidth,startWidth-deltaX),newX=startPos.x+deltaX,newHeight=Math.max(minHeight,startHeight+deltaY);break;case"ne":newWidth=Math.max(minWidth,startWidth+deltaX),newHeight=Math.max(minHeight,startHeight-deltaY),newY=startPos.y+deltaY;break;case"nw":newWidth=Math.max(minWidth,startWidth-deltaX),newX=startPos.x+deltaX,newHeight=Math.max(minHeight,startHeight-deltaY),newY=startPos.y+deltaY}const proposedGroupBounds={left:newX-newWidth/2,right:newX+newWidth/2,top:newY-newHeight/2,bottom:newY+newHeight/2};let canResize=!0;nodes.forEach((node=>{const nodeBounds=node.getBoundingBox(),nodeWidth=nodeBounds.getRight()-nodeBounds.getLeft(),nodeHeight=nodeBounds.getBottom()-nodeBounds.getTop();(nodeWidth+20>newWidth||nodeHeight+20>newHeight)&&(canResize=!1)})),canResize&&(group.setSize({width:newWidth,height:newHeight}),group.setPosition(newX,newY),adjustNodesPosition(nodes,proposedGroupBounds))},handleMouseUp=()=>{isResizing=!1;const finalGroupBounds={left:group.getPosition().x-group.getSize().width/2,right:group.getPosition().x+group.getSize().width/2,top:group.getPosition().y-group.getSize().height/2,bottom:group.getPosition().y+group.getSize().height/2};adjustNodesPosition(nodes,finalGroupBounds),document.removeEventListener("mousemove",handleMouseMove),document.removeEventListener("mouseup",handleMouseUp)};document.addEventListener("mousemove",handleMouseMove),document.addEventListener("mouseup",handleMouseUp)},outerWidth=width+20,outerHeight=height+20+25,rectWidth=width,rectHeight=height;return react.createElement("svg",{width:outerWidth,height:outerHeight,className:"group","data-groupid":group.getID(),style:{position:"absolute",top:x-10,left:y-10,pointerEvents:"none"}},react.createElement("foreignObject",{x:10,y:10,width,height:25,style:{pointerEvents:"all"}},isEditing?react.createElement("input",{value:groupName,onChange:event=>{setGroupName(event.target.value)},onBlur:()=>{setIsEditing(!1),group.setName(groupName)},style:{fontSize:"14px",fontFamily:"sans-serif",fontWeight:"bold",color:group.getColor(),background:"transparent",border:"none",outline:"none",width:"100%",pointerEvents:"auto"},autoFocus:!0}):react.createElement("div",{className:"group-name","data-groupid":group.getID(),onDoubleClick:()=>{setIsEditing(!0)},style:{fontSize:"14px",fontFamily:"sans-serif",fontWeight:"bold",color:group.getColor(),pointerEvents:"auto"}},groupName)),react.createElement("rect",{x:10,y:35,width:rectWidth,height:rectHeight,fill:group.getColor(),fillOpacity:.05,stroke:group.getColor(),strokeWidth:2,rx:5,ry:5,style:{pointerEvents:"all"}}),group.isSelected()&&react.createElement(react.Fragment,null,react.createElement("rect",{x:8,y:33,"data-groupid":group.getID(),width:rectWidth+4,height:rectHeight+4,fill:"none",stroke:"#FFA500",strokeWidth:2,style:{pointerEvents:"all"}}),react.createElement("circle",{cx:10,cy:35,r:5,fill:"#FFA500",onMouseDown:handleResize("nw"),style:{cursor:"nwse-resize",pointerEvents:"all"}}),react.createElement("circle",{cx:10+rectWidth,cy:35,r:5,fill:"#FFA500",onMouseDown:handleResize("ne"),style:{cursor:"nesw-resize",pointerEvents:"all"}}),react.createElement("circle",{cx:10,cy:35+rectHeight,r:5,fill:"#FFA500",onMouseDown:handleResize("sw"),style:{cursor:"nesw-resize",pointerEvents:"all"}}),react.createElement("circle",{cx:10+rectWidth,cy:35+rectHeight,r:5,fill:"#FFA500",onMouseDown:handleResize("se"),style:{cursor:"nwse-resize",pointerEvents:"all"}})))};class DefaultGroupFactory extends react_canvas_core_dist.a3{constructor(){super("default"),this.generateReactWidget=event=>react.createElement(DefaultGroupWidget,{engine:event.engine,group:event.model}),this.generateModel=event=>new DefaultGroupModel({})}}},"../packages/react-diagrams/dist/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{z6:()=>DagreEngine,Qo:()=>dist.Qo,Py:()=>react_diagrams_defaults_dist.Py,oQ:()=>react_diagrams_defaults_dist.oQ,Si:()=>react_diagrams_defaults_dist.Si,Fs:()=>react_diagrams_defaults_dist.Fs,Gi:()=>react_diagrams_defaults_dist.Gi,Vm:()=>dist.Vm,dZ:()=>dist.dZ,aS:()=>dist.aS,KW:()=>dist.KW,XF:()=>dist.XF,xU:()=>PathFindingLinkFactory,AJ:()=>dist.AJ,tK:()=>dist.tK,ER:()=>dist.ER,$Q:()=>RightAngleLinkFactory,C6:()=>RightAngleLinkModel,ZP:()=>react_diagrams_dist});var dist=__webpack_require__("../packages/react-diagrams-core/dist/index.js"),react_diagrams_defaults_dist=__webpack_require__("../packages/react-diagrams-defaults/dist/index.js"),react=__webpack_require__("../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js");class PathFindingLinkModel extends react_diagrams_defaults_dist.Si{constructor(options={}){super(Object.assign({type:PathFindingLinkFactory.NAME},options))}performanceTune(){return!1}}var first=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/first.js"),first_default=__webpack_require__.n(first),last=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/last.js"),last_default=__webpack_require__.n(last),pathfinding=__webpack_require__("../node_modules/.pnpm/pathfinding@0.4.18/node_modules/pathfinding/index.js");const pathFinderInstance=new pathfinding.JumpPointFinder({heuristic:pathfinding.Heuristic.manhattan,diagonalMovement:pathfinding.DiagonalMovement.Never});class PathFinding{constructor(factory){this.instance=pathFinderInstance,this.factory=factory}calculateDirectPath(from,to){const matrix=this.factory.getCanvasMatrix(),grid=new pathfinding.Grid(matrix);return pathFinderInstance.findPath(this.factory.translateRoutingX(Math.floor(from.getX()/this.factory.ROUTING_SCALING_FACTOR)),this.factory.translateRoutingY(Math.floor(from.getY()/this.factory.ROUTING_SCALING_FACTOR)),this.factory.translateRoutingX(Math.floor(to.getX()/this.factory.ROUTING_SCALING_FACTOR)),this.factory.translateRoutingY(Math.floor(to.getY()/this.factory.ROUTING_SCALING_FACTOR)),grid)}calculateLinkStartEndCoords(matrix,path){const startIndex=path.findIndex((point=>!!matrix[point[1]]&&0===matrix[point[1]][point[0]])),endIndex=path.length-1-path.slice().reverse().findIndex((point=>!!matrix[point[1]]&&0===matrix[point[1]][point[0]]));if(-1===startIndex||-1===endIndex)return;const pathToStart=path.slice(0,startIndex),pathToEnd=path.slice(endIndex);return{start:{x:path[startIndex][0],y:path[startIndex][1]},end:{x:path[endIndex][0],y:path[endIndex][1]},pathToStart,pathToEnd}}calculateDynamicPath(routingMatrix,start,end,pathToStart,pathToEnd){const grid=new pathfinding.Grid(routingMatrix),dynamicPath=pathFinderInstance.findPath(start.x,start.y,end.x,end.y,grid),pathCoords=pathToStart.concat(dynamicPath,pathToEnd).map((coords=>[this.factory.translateRoutingX(coords[0],!0),this.factory.translateRoutingY(coords[1],!0)]));return pathfinding.Util.compressPath(pathCoords)}}class PathFindingLinkWidget extends react.Component{constructor(props){super(props),this.refPaths=[],this.state={selected:!1},this.pathFinding=new PathFinding(this.props.factory)}componentDidUpdate(){this.props.link.setRenderedPaths(this.refPaths.map((ref=>ref.current)))}componentDidMount(){this.props.link.setRenderedPaths(this.refPaths.map((ref=>ref.current)))}componentWillUnmount(){this.props.link.setRenderedPaths([])}generateLink(path,id){const ref=react.createRef();return this.refPaths.push(ref),react.createElement(react_diagrams_defaults_dist.AQ,{key:`link-${id}`,path,selected:this.state.selected,diagramEngine:this.props.diagramEngine,factory:this.props.diagramEngine.getFactoryForLink(this.props.link),link:this.props.link,forwardRef:ref,onSelection:selected=>{this.setState({selected})},extras:{}})}render(){this.refPaths=[];var points=this.props.link.getPoints(),paths=[];const directPathCoords=this.pathFinding.calculateDirectPath(first_default()(points),last_default()(points)),routingMatrix=this.props.factory.getRoutingMatrix(),smartLink=this.pathFinding.calculateLinkStartEndCoords(routingMatrix,directPathCoords);if(smartLink){const{start,end,pathToStart,pathToEnd}=smartLink,simplifiedPath=this.pathFinding.calculateDynamicPath(routingMatrix,start,end,pathToStart,pathToEnd);paths.push(this.generateLink(this.props.factory.generateDynamicPath(simplifiedPath),"0"))}return react.createElement(react.Fragment,null,paths)}}PathFindingLinkWidget.displayName="PathFindingLinkWidget";var cloneDeep=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/cloneDeep.js"),cloneDeep_default=__webpack_require__.n(cloneDeep),concat=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/concat.js"),concat_default=__webpack_require__.n(concat),defer=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/defer.js"),defer_default=__webpack_require__.n(defer),flatMap=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/flatMap.js"),flatMap_default=__webpack_require__.n(flatMap),get=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/get.js"),get_default=__webpack_require__.n(get),minBy=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/minBy.js"),minBy_default=__webpack_require__.n(minBy),maxBy=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/maxBy.js"),maxBy_default=__webpack_require__.n(maxBy),range=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/range.js"),range_default=__webpack_require__.n(range),reduce=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/reduce.js"),reduce_default=__webpack_require__.n(reduce),values=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/values.js"),values_default=__webpack_require__.n(values),paths_js_path=__webpack_require__("../node_modules/.pnpm/paths-js@0.4.11/node_modules/paths-js/path.js"),react_canvas_core_dist=__webpack_require__("../packages/react-canvas-core/dist/index.js");class PathFindingLinkFactory extends react_diagrams_defaults_dist.oQ{constructor(){super(PathFindingLinkFactory.NAME),this.ROUTING_SCALING_FACTOR=5,this.canvasMatrix=[],this.routingMatrix=[],this.hAdjustmentFactor=0,this.vAdjustmentFactor=0,this.calculateMatrixDimensions=()=>{const allNodesCoords=values_default()(this.engine.getModel().getNodes()).map((item=>({x:item.getX(),width:item.width,y:item.getY(),height:item.height}))),allLinks=values_default()(this.engine.getModel().getLinks()),allPortsCoords=flatMap_default()(allLinks.map((link=>[link.getSourcePort(),link.getTargetPort()]))).filter((port=>null!==port)).map((item=>({x:item.getX(),width:item.width,y:item.getY(),height:item.height}))),allPointsCoords=flatMap_default()(allLinks.map((link=>link.getPoints()))).map((item=>({x:item.getX(),width:0,y:item.getY(),height:0}))),sumProps=(object,props)=>reduce_default()(props,((acc,prop)=>acc+get_default()(object,prop,0)),0),canvas=this.engine.getCanvas(),concatedCoords=concat_default()(allNodesCoords,allPortsCoords,allPointsCoords),minX=Math.floor(Math.min(get_default()(minBy_default()(concatedCoords,"x"),"x",0),0)/this.ROUTING_SCALING_FACTOR)*this.ROUTING_SCALING_FACTOR,maxXElement=maxBy_default()(concatedCoords,(item=>sumProps(item,["x","width"]))),maxX=Math.max(sumProps(maxXElement,["x","width"]),canvas.offsetWidth),minYCoords=minBy_default()(concatedCoords,"y"),minY=Math.floor(Math.min(get_default()(minYCoords,"y",0),0)/this.ROUTING_SCALING_FACTOR)*this.ROUTING_SCALING_FACTOR,maxYElement=maxBy_default()(concatedCoords,(item=>sumProps(item,["y","height"]))),maxY=Math.max(sumProps(maxYElement,["y","height"]),canvas.offsetHeight);return{width:Math.ceil(Math.abs(minX)+maxX),hAdjustmentFactor:Math.abs(minX)/this.ROUTING_SCALING_FACTOR+1,height:Math.ceil(Math.abs(minY)+maxY),vAdjustmentFactor:Math.abs(minY)/this.ROUTING_SCALING_FACTOR+1}},this.markNodes=matrix=>{values_default()(this.engine.getModel().getNodes()).forEach((node=>{const startX=Math.floor(node.getX()/this.ROUTING_SCALING_FACTOR),endX=Math.ceil((node.getX()+node.width)/this.ROUTING_SCALING_FACTOR),startY=Math.floor(node.getY()/this.ROUTING_SCALING_FACTOR),endY=Math.ceil((node.getY()+node.height)/this.ROUTING_SCALING_FACTOR);for(let x=startX-1;x<=endX+1;x++)for(let y=startY-1;y<endY+1;y++)this.markMatrixPoint(matrix,this.translateRoutingX(x),this.translateRoutingY(y))}))},this.markPorts=matrix=>{flatMap_default()(values_default()(this.engine.getModel().getLinks()).map((link=>[].concat(link.getSourcePort(),link.getTargetPort())))).filter((port=>null!==port)).forEach((port=>{const startX=Math.floor(port.x/this.ROUTING_SCALING_FACTOR),endX=Math.ceil((port.x+port.width)/this.ROUTING_SCALING_FACTOR),startY=Math.floor(port.y/this.ROUTING_SCALING_FACTOR),endY=Math.ceil((port.y+port.height)/this.ROUTING_SCALING_FACTOR);for(let x=startX-1;x<=endX+1;x++)for(let y=startY-1;y<endY+1;y++)this.markMatrixPoint(matrix,this.translateRoutingX(x),this.translateRoutingY(y))}))},this.markMatrixPoint=(matrix,x,y)=>{void 0!==matrix[y]&&void 0!==matrix[y][x]&&(matrix[y][x]=1)}}setDiagramEngine(engine){super.setDiagramEngine(engine),engine.getStateMachine().registerListener({stateChanged:event=>{if(event.newState instanceof react_canvas_core_dist.s2){const deRegister=engine.getActionEventBus().registerAction(new react_canvas_core_dist.aU({type:react_canvas_core_dist.n$.MOUSE_UP,fire:()=>{this.calculateRoutingMatrix(),engine.repaintCanvas(),deRegister()}}))}}}),this.listener=engine.registerListener({canvasReady:()=>{defer_default()((()=>{this.calculateRoutingMatrix(),engine.repaintCanvas()}))}})}setFactoryBank(bank){super.setFactoryBank(bank),!bank&&this.listener&&this.listener.deregister()}generateReactWidget(event){return react.createElement(PathFindingLinkWidget,{diagramEngine:this.engine,link:event.model,factory:this})}generateModel(event){return new PathFindingLinkModel}getCanvasMatrix(){return 0===this.canvasMatrix.length&&this.calculateCanvasMatrix(),this.canvasMatrix}calculateCanvasMatrix(){const{width:canvasWidth,hAdjustmentFactor,height:canvasHeight,vAdjustmentFactor}=this.calculateMatrixDimensions();this.hAdjustmentFactor=hAdjustmentFactor,this.vAdjustmentFactor=vAdjustmentFactor;const matrixWidth=Math.ceil(canvasWidth/this.ROUTING_SCALING_FACTOR),matrixHeight=Math.ceil(canvasHeight/this.ROUTING_SCALING_FACTOR);this.canvasMatrix=range_default()(0,matrixHeight).map((()=>new Array(matrixWidth).fill(0)))}getRoutingMatrix(){return 0===this.routingMatrix.length&&this.calculateRoutingMatrix(),this.routingMatrix}calculateRoutingMatrix(){const matrix=cloneDeep_default()(this.getCanvasMatrix());this.markNodes(matrix),this.markPorts(matrix),this.routingMatrix=matrix}translateRoutingX(x,reverse=!1){return x+this.hAdjustmentFactor*(reverse?-1:1)}translateRoutingY(y,reverse=!1){return y+this.vAdjustmentFactor*(reverse?-1:1)}generateDynamicPath(pathCoords){let path=paths_js_path();return path=path.moveto(pathCoords[0][0]*this.ROUTING_SCALING_FACTOR,pathCoords[0][1]*this.ROUTING_SCALING_FACTOR),pathCoords.slice(1).forEach((coords=>{path=path.lineto(coords[0]*this.ROUTING_SCALING_FACTOR,coords[1]*this.ROUTING_SCALING_FACTOR)})),path.print()}}PathFindingLinkFactory.NAME="pathfinding";var geometry_dist=__webpack_require__("../packages/geometry/dist/index.js");class RightAngleLinkWidget extends react.Component{constructor(props){super(props),this.handleMove=function(event){this.draggingEvent(event,this.dragging_index)}.bind(this),this.handleUp=function(event){this.setState({canDrag:!1,selected:!1}),window.removeEventListener("mousemove",this.handleMove),window.removeEventListener("mouseup",this.handleUp)}.bind(this),this.refPaths=[],this.state={selected:!1,canDrag:!1},this.dragging_index=0}componentDidUpdate(){this.props.link.setRenderedPaths(this.refPaths.map((ref=>ref.current)))}componentDidMount(){this.props.link.setRenderedPaths(this.refPaths.map((ref=>ref.current)))}componentWillUnmount(){this.props.link.setRenderedPaths([])}generateLink(path,extraProps,id){const ref=react.createRef();return this.refPaths.push(ref),react.createElement(react_diagrams_defaults_dist.AQ,{key:`link-${id}`,path,selected:this.state.selected,diagramEngine:this.props.diagramEngine,factory:this.props.diagramEngine.getFactoryForLink(this.props.link),link:this.props.link,forwardRef:ref,onSelection:selected=>{this.setState({selected})},extras:extraProps})}calculatePositions(points,event,index,coordinate){if(0===index){let point=new dist.Xs({link:this.props.link,position:new geometry_dist.E9(points[index].getX(),points[index].getY())});return this.props.link.addPoint(point,index),void this.dragging_index++}if(index===points.length-2){let point=new dist.Xs({link:this.props.link,position:new geometry_dist.E9(points[index+1].getX(),points[index+1].getY())});return void this.props.link.addPoint(point,index+1)}if(index-2>0){let _points={[index-2]:points[index-2].getPosition(),[index+1]:points[index+1].getPosition(),[index-1]:points[index-1].getPosition()};if(Math.abs(_points[index-1][coordinate]-_points[index+1][coordinate])<5)return _points[index-2][coordinate]=this.props.diagramEngine.getRelativeMousePoint(event)[coordinate],_points[index+1][coordinate]=this.props.diagramEngine.getRelativeMousePoint(event)[coordinate],points[index-2].setPosition(_points[index-2]),points[index+1].setPosition(_points[index+1]),points[index-1].remove(),points[index-1].remove(),this.dragging_index--,void this.dragging_index--}if(index+2<points.length-2){let _points={[index+3]:points[index+3].getPosition(),[index+2]:points[index+2].getPosition(),[index+1]:points[index+1].getPosition(),[index]:points[index].getPosition()};if(Math.abs(_points[index+1][coordinate]-_points[index+2][coordinate])<5)return _points[index][coordinate]=this.props.diagramEngine.getRelativeMousePoint(event)[coordinate],_points[index+3][coordinate]=this.props.diagramEngine.getRelativeMousePoint(event)[coordinate],points[index].setPosition(_points[index]),points[index+3].setPosition(_points[index+3]),points[index+1].remove(),void points[index+1].remove()}let _points={[index]:points[index].getPosition(),[index+1]:points[index+1].getPosition()};_points[index][coordinate]=this.props.diagramEngine.getRelativeMousePoint(event)[coordinate],_points[index+1][coordinate]=this.props.diagramEngine.getRelativeMousePoint(event)[coordinate],points[index].setPosition(_points[index]),points[index+1].setPosition(_points[index+1])}draggingEvent(event,index){let points=this.props.link.getPoints(),dx=Math.abs(points[index].getX()-points[index+1].getX()),dy=Math.abs(points[index].getY()-points[index+1].getY());0===dx?this.calculatePositions(points,event,index,"x"):0===dy&&this.calculatePositions(points,event,index,"y"),this.props.link.setFirstAndLastPathsDirection()}render(){let points=this.props.link.getPoints(),paths=[],pointLeft=points[0],pointRight=points[points.length-1],hadToSwitch=!1;pointLeft.getX()>pointRight.getX()&&(pointLeft=points[points.length-1],pointRight=points[0],hadToSwitch=!0);let dy=Math.abs(points[0].getY()-points[points.length-1].getY());if(null===this.props.link.getTargetPort()&&2===points.length)[...Array(2)].forEach((item=>{this.props.link.addPoint(new dist.Xs({link:this.props.link,position:new geometry_dist.E9(pointLeft.getX(),pointRight.getY())}),1)})),this.props.link.setManuallyFirstAndLastPathsDirection(!0,!0);else if(null===this.props.link.getTargetPort()&&null!==this.props.link.getSourcePort())points[1].setPosition(pointRight.getX()+(pointLeft.getX()-pointRight.getX())/2,hadToSwitch?pointRight.getY():pointLeft.getY()),points[2].setPosition(pointRight.getX()+(pointLeft.getX()-pointRight.getX())/2,hadToSwitch?pointLeft.getY():pointRight.getY());else if(!this.state.canDrag&&points.length>2)for(let i=1;i<points.length;i+=points.length-2)i-1==0?this.props.link.getFirstPathXdirection()?points[i].setPosition(points[i].getX(),points[i-1].getY()):points[i].setPosition(points[i-1].getX(),points[i].getY()):this.props.link.getLastPathXdirection()?points[i-1].setPosition(points[i-1].getX(),points[i].getY()):points[i-1].setPosition(points[i].getX(),points[i-1].getY());2!==points.length||0===dy||this.state.canDrag||this.props.link.addPoint(new dist.Xs({link:this.props.link,position:new geometry_dist.E9(pointLeft.getX(),pointRight.getY())}));for(let j=0;j<points.length-1;j++)paths.push(this.generateLink(dist.hL.generateLinePath(points[j],points[j+1]),{"data-linkid":this.props.link.getID(),"data-point":j,onMouseDown:event=>{0===event.button&&(this.setState({canDrag:!0}),this.dragging_index=j,window.addEventListener("mousemove",this.handleMove),window.addEventListener("mouseup",this.handleUp))},onMouseEnter:event=>{this.setState({selected:!0}),this.props.link.lastHoverIndexOfPath=j}},j));return this.refPaths=[],react.createElement("g",{"data-default-link-test":this.props.link.getOptions().testName},paths)}}RightAngleLinkWidget.displayName="RightAngleLinkWidget",RightAngleLinkWidget.defaultProps={color:"red",width:3,link:null,smooth:!1,diagramEngine:null,factory:null};class RightAngleLinkModel extends react_diagrams_defaults_dist.Si{constructor(options={}){super(Object.assign({type:RightAngleLinkFactory.NAME},options)),this.lastHoverIndexOfPath=0,this._lastPathXdirection=!1,this._firstPathXdirection=!1}setFirstAndLastPathsDirection(){let points=this.getPoints();for(let i=1;i<points.length;i+=points.length-2){let dx=Math.abs(points[i].getX()-points[i-1].getX()),dy=Math.abs(points[i].getY()-points[i-1].getY());i-1==0?this._firstPathXdirection=dx>dy:this._lastPathXdirection=dx>dy}}addPoint(pointModel,index=1){return super.addPoint(pointModel,index),this.setFirstAndLastPathsDirection(),pointModel}deserialize(event){super.deserialize(event),this.setFirstAndLastPathsDirection()}setManuallyFirstAndLastPathsDirection(first,last){this._firstPathXdirection=first,this._lastPathXdirection=last}getLastPathXdirection(){return this._lastPathXdirection}getFirstPathXdirection(){return this._firstPathXdirection}setWidth(width){this.options.width=width,this.fireEvent({width},"widthChanged")}setColor(color){this.options.color=color,this.fireEvent({color},"colorChanged")}}class RightAngleLinkFactory extends react_diagrams_defaults_dist.oQ{constructor(){super(RightAngleLinkFactory.NAME)}generateModel(event){return new RightAngleLinkModel}generateReactWidget(event){return react.createElement(RightAngleLinkWidget,{diagramEngine:this.engine,link:event.model,factory:this})}}RightAngleLinkFactory.NAME="rightAngle";var dagre=__webpack_require__("../node_modules/.pnpm/dagre@0.8.5/node_modules/dagre/index.js"),every=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/every.js"),every_default=__webpack_require__.n(every),findIndex=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/findIndex.js"),findIndex_default=__webpack_require__.n(findIndex),forEach=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/forEach.js"),forEach_default=__webpack_require__.n(forEach),map=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/map.js"),map_default=__webpack_require__.n(map),sortBy=__webpack_require__("../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/sortBy.js"),sortBy_default=__webpack_require__.n(sortBy);class DagreEngine{constructor(options={}){this.options=options}redistribute(model){var g=new dagre.graphlib.Graph({multigraph:!0,compound:!0});g.setGraph(this.options.graph||{}),g.setDefaultEdgeLabel((function(){return{}})),forEach_default()(model.getNodes(),(node=>{g.setNode(node.getID(),{width:node.width,height:node.height})})),forEach_default()(model.getLinks(),(link=>{link.getSourcePort()&&link.getTargetPort()&&g.setEdge({v:link.getSourcePort().getNode().getID(),w:link.getTargetPort().getNode().getID(),name:link.getID()})})),dagre.layout(g),g.nodes().forEach((v=>{const node=g.node(v);model.getNode(v).setPosition(node.x-node.width/2,node.y-node.height/2)})),this.options.includeLinks&&g.edges().forEach((e=>{const edge=g.edge(e),link=model.getLink(e.name),points=[link.getFirstPoint()];for(let i=1;i<edge.points.length-1;i++)points.push(new dist.Xs({link,position:new geometry_dist.E9(edge.points[i].x,edge.points[i].y)}));link.setPoints(points.concat(link.getLastPoint()))}))}refreshLinks(diagram){const{nodeMargin}=this.options,nodes=diagram.getNodes(),links=diagram.getLinks();let maxChunkRowIndex=-1;const chunks={},NodeXColumnIndexDictionary={};let verticalLines=[];forEach_default()(nodes,(node=>{const nodeColumnCenter=node.getX()+node.width/2;every_default()(verticalLines,(vLine=>Math.abs(nodeColumnCenter-vLine)>nodeMargin))&&verticalLines.push(nodeColumnCenter)})),verticalLines=verticalLines.sort(((a,b)=>a-b)),forEach_default()(verticalLines,((line,index)=>{chunks[index]={},chunks[index+.5]={}})),forEach_default()(nodes,(node=>{const nodeColumnCenter=node.getX()+node.width/2,startChunkIndex=Math.floor(node.getY()/nodeMargin),endChunkIndex=Math.floor((node.getY()+node.height)/nodeMargin);endChunkIndex>maxChunkRowIndex&&(maxChunkRowIndex=endChunkIndex);const nodeColumnIndex=findIndex_default()(verticalLines,(vLine=>Math.abs(nodeColumnCenter-vLine)<=nodeMargin));forEach_default()(range_default()(startChunkIndex,endChunkIndex+1),(chunkIndex=>{chunks[nodeColumnIndex][chunkIndex]=!0})),NodeXColumnIndexDictionary[node.getX()]=nodeColumnIndex}));const edges=map_default()(links,(link=>{if(link.getSourcePort()&&link.getTargetPort()){const source=link.getSourcePort().getNode(),target=link.getTargetPort().getNode(),sourceIndex=NodeXColumnIndexDictionary[source.getX()],targetIndex=NodeXColumnIndexDictionary[target.getX()];return sourceIndex>targetIndex?{link,sourceIndex,sourceY:source.getY()+source.height/2,source,targetIndex,targetY:target.getY()+source.height/2,target}:{link,sourceIndex:targetIndex,sourceY:target.getY()+target.height/2,source:target,targetIndex:sourceIndex,targetY:source.getY()+source.height/2,target:source}}})),sortedEdges=sortBy_default()(edges,(link=>Math.abs(link.targetIndex-link.sourceIndex)));this.options.includeLinks&&forEach_default()(sortedEdges,(edge=>{const link=diagram.getLink(edge.link.getID());if(Math.abs(edge.sourceIndex-edge.targetIndex)>1){const columns=range_default()(edge.sourceIndex-1,edge.targetIndex),chunkIndex=Math.floor(edge.sourceY/nodeMargin),targetChunkIndex=Math.floor(edge.targetY/nodeMargin);let northCost=1,aboveRowIndex=chunkIndex;for(;aboveRowIndex>=0&&!every_default()(columns,(columnIndex=>!(chunks[columnIndex][aboveRowIndex]||chunks[columnIndex+.5][aboveRowIndex]||chunks[columnIndex-.5][aboveRowIndex])));aboveRowIndex--,northCost++);let southCost=0,belowRowIndex=chunkIndex;for(;belowRowIndex<=maxChunkRowIndex&&!every_default()(columns,(columnIndex=>!(chunks[columnIndex][belowRowIndex]||chunks[columnIndex+.5][belowRowIndex]||chunks[columnIndex-.5][belowRowIndex])));belowRowIndex++,southCost++);const pathRowIndex=southCost+(belowRowIndex-targetChunkIndex)<northCost+(targetChunkIndex-aboveRowIndex)?belowRowIndex+1:aboveRowIndex-1,points=[link.getFirstPoint()];points.push(new dist.Xs({link,position:new geometry_dist.E9((verticalLines[columns[0]]+verticalLines[columns[0]+1])/2,(pathRowIndex+.5)*nodeMargin)})),forEach_default()(columns,(column=>{points.push(new dist.Xs({link,position:new geometry_dist.E9(verticalLines[column],(pathRowIndex+.5)*nodeMargin)})),points.push(new dist.Xs({link,position:new geometry_dist.E9((verticalLines[column]+verticalLines[column-1])/2,(pathRowIndex+.5)*nodeMargin)})),chunks[column][pathRowIndex]=!0,chunks[column][pathRowIndex+1]=!0,chunks[column+.5][pathRowIndex]=!0,chunks[column+.5][pathRowIndex+1]=!0})),link.setPoints(points.concat(link.getLastPoint()))}else{link.setPoints([link.getFirstPoint(),link.getLastPoint()]);const columnIndex=(edge.sourceIndex+edge.targetIndex)/2;chunks[columnIndex]||(chunks[columnIndex]={});const rowIndex=Math.floor((edge.sourceY+edge.targetY)/2/nodeMargin);chunks[columnIndex][rowIndex]=!0,chunks[columnIndex][rowIndex+1]=!0}}))}}const react_diagrams_dist=(options={})=>{const engine=new dist.Zc(options);return engine.getLayerFactories().registerFactory(new dist.JM),engine.getLayerFactories().registerFactory(new dist.JW),engine.getLayerFactories().registerFactory(new dist.Jq),engine.getLayerFactories().registerFactory(new react_canvas_core_dist.B1),engine.getLabelFactories().registerFactory(new react_diagrams_defaults_dist.eW),engine.getNodeFactories().registerFactory(new react_diagrams_defaults_dist.HU),engine.getLinkFactories().registerFactory(new react_diagrams_defaults_dist.oQ),engine.getLinkFactories().registerFactory(new PathFindingLinkFactory),engine.getPortFactories().registerFactory(new react_diagrams_defaults_dist.Q7),engine.getGroupFactories().registerFactory(new react_diagrams_defaults_dist.uM),engine.getStateMachine().pushState(new dist.Qo),engine}}}]);
//# sourceMappingURL=235.880dfdb9.iframe.bundle.js.map